"use strict";SharkGame.Gate={tabId:"gate",tabDiscovered:!1,tabSeen:!1,tabName:"Strange Gate",tabBg:"img/bg/bg-gate.png",discoverReq:{upgrade:["gateDiscovery","farAbandonedExploration","farHavenExploration","rapidRecharging","arcaneCompass","apologeticAmnesty"]},message:"A foreboding circular structure, closed shut.<br/>There are many slots, and a sign you know to mean 'insert items here'.",messageOneSlot:"A foreboding circular structure, closed shut.<br/>One slot remains.",messageOpened:"A foreboding circular structure, wide open.<br/>The water glows and shimmers within it. A gentle tug pulls at you.",messagePaid:"The slot accepts your donation and ceases to be.",messageCantPay:"The slot spits everything back out. You get the sense it wants more at once.",messagePaidNotOpen:"For some reason, every slot is already filled. The structure doesn't open, though.<br/><strong>Perhaps it needs something else.</strong>",messageAllPaid:"The last slot closes. The structure opens. The water glows and shimmers within it.<br/>A gentle tug pulls at you.",messageEnter:"You swim through the gate...",sceneClosedImage:"img/events/misc/scene-gate-closed.png",sceneAlmostOpenImage:"img/events/misc/scene-gate-one-slot.png",sceneOpenImage:"img/events/misc/scene-gate-open.png",sceneClosedButFilledImage:"img/events/misc/scene-gate-closed-but-filled.png",requirements:{},completedRequirements:{},init(){SharkGame.TabHandler.registerTab(this),SharkGame.Gate.opened=!1,SharkGame.Gate.resetSlots()},setup(){},resetSlots(){SharkGame.Gate.requirements={},SharkGame.Gate.completedRequirements={}},createSlots(e,t){const s=SharkGame.Gate,r=s.requirements,a=s.completedRequirements;e.slots&&(r.slots={},sharkmisc.tryAddProperty(a,"slots",{}),$.each(e.slots,((e,s)=>{r.slots[e]=Math.floor(s*t),sharkmisc.tryAddProperty(a.slots,e,!1)}))),e.upgrades&&(r.upgrades=[],sharkmisc.tryAddProperty(a,"upgrades",{}),$.each(e.upgrades,((e,t)=>{r.upgrades.push(t),sharkmisc.tryAddProperty(a.upgrades,t,!1)}))),e.resources&&(r.resources={},sharkmisc.tryAddProperty(a,"resources",{}),$.each(e.resources,((e,t)=>{r.resources[e]=t,sharkmisc.tryAddProperty(a.resources,e,!1)})))},switchTo(){const e=SharkGame.Gate,t=$("#content");if(t.append($("<div>").attr("id","tabMessage")),t.append($("<div>").attr("id","buttonList")),SharkGame.Gate.getResourcesLeft(),e.shouldBeOpen())SharkGame.Button.makeButton("gateEnter","Enter gate",$("#buttonList"),e.onEnterButton);else if(SharkGame.WorldTypes[world.worldType].gateRequirements.slots){const t=$("#buttonList");$.each(e.requirements.slots,((s,r)=>{if(!e.completedRequirements.slots[s]){const a=sharktext.getResourceName(s,!1,!1,sharkcolor.getElementColor("tooltipbox","background-color"));SharkGame.Button.makeHoverscriptButton("gateCost-"+s,"Insert "+sharktext.beautify(r)+" "+a+" into "+a+" slot",t,e.onGateButton,e.onHover,e.onUnhover)}}))}let s=e.getMessage();const r=$("#tabMessage");SharkGame.Settings.current.showTabImages&&(s="<img width=400 height=200 src='"+e.getSceneImagePath()+"' id='tabSceneImageEssence'>"+s,r.css("background-image","url('"+e.tabBg+"')")),r.html(s)},getMessage(){const e=SharkGame.Gate;if(e.shouldBeOpen())return e.messageOpened;const t=e.getSlotsLeft(),s=e.getUpgradesLeft(),r=e.getResourcesLeft();if(!1!==t){if(t>1)return e.message;if(1===t)return e.messageOneSlot}return!1!==s||!1!==r?e.messagePaidNotOpen:(log.addError("No gate requirements found."),"This is a failsafe message. Something has gone wrong internally.")},getSlotsLeft(){const e=SharkGame.Gate;let t=0;return _.each(e.completedRequirements.slots,(e=>{t+=e?0:1})),0!==_.size(e.requirements.slots)&&t},getUpgradesLeft(){const e=SharkGame.Gate;let t=0;return _.each(e.completedRequirements.upgrades,(e=>{t+=e?0:1})),!!e.requirements.upgrades&&(0===e.requirements.upgrades.length&&t)},getResourcesLeft(){const e=SharkGame.Gate;$.each(e.completedRequirements.resources,(t=>{e.checkResourceRequirements(t)}));const t=[];return $.each(e.completedRequirements.resources,((e,s)=>{s&&t.push(e)})),t||!1},onHover(){const e=SharkGame.Gate,t=$(this),s=t.attr("id").split("-")[1],r=res.getResource(s),a=e.requirements.slots[s];r<a&&t.html(`Need <span class='click-passthrough' style='color:#FFDE0A'>${sharktext.beautify(a-r)}</span> more ${sharktext.getResourceName(s,!1,!1,sharkcolor.getElementColor(t.attr("id"),"background-color"))} for ${sharktext.getResourceName(s,!1,!1,sharkcolor.getElementColor(t.attr("id"),"background-color"))} slot`)},onUnhover(){const e=SharkGame.Gate,t=$(this),s=t.attr("id").split("-")[1],r=e.requirements.slots[s];t.html("Insert "+sharktext.beautify(r)+" "+sharktext.getResourceName(s,!1,!1,sharkcolor.getElementColor(t.attr("id"),"background-color"))+" into "+sharktext.getResourceName(s,!1,!1,sharkcolor.getElementColor(t.attr("id"),"background-color"))+" slot")},update(){},onGateButton(){const e=SharkGame.Gate,t=$(this).attr("id").split("-")[1];let s="";const r=e.requirements.slots[t]*(res.getResource("numen")+1);if(res.getResource(t)>=r)e.completedRequirements.slots[t]=!0,res.changeResource(t,-r),$(this).remove(),e.shouldBeOpen()?(s=e.messageAllPaid,SharkGame.Button.makeButton("gateEnter","Enter gate",$("#buttonList"),e.onEnterButton)):s=e.messagePaid;else{s=e.messageCantPay+"<br/>";const a=r-res.getResource(t);s+=sharktext.beautify(a)+" more."}SharkGame.Settings.current.showTabImages&&(s="<img width=400 height=200 src='"+e.getSceneImagePath()+"' id='tabSceneImageEssence'>"+s),$("#tabMessage").html(s)},onEnterButton(){$(this).remove(),SharkGame.Gate.enterGate()},enterGate(){$("#tabMessage").html(SharkGame.Gate.messageEnter),SharkGame.wonGame=!0,main.endGame()},shouldBeOpen:()=>_.every(SharkGame.Gate.completedRequirements,(e=>_.every(e))),checkUpgradeRequirements(e){const t=SharkGame.Gate;t.completedRequirements.upgrades&&!1===t.completedRequirements.upgrades[e]&&(t.completedRequirements.upgrades[e]=!0)},checkResourceRequirements(e){const t=SharkGame.Gate;t.requirements.resources&&res.getResource(e)>=t.requirements.resources[e]&&(t.completedRequirements.resources[e]=!0)},getSceneImagePath(){const e=SharkGame.Gate,t=e.getSlotsLeft(),s=e.getUpgradesLeft(),r=e.getResourcesLeft();return e.shouldBeOpen()?e.sceneOpenImage:t>1?e.sceneClosedImage:1!==t||s||r?t||!s&&!r?e.sceneClosedImage:e.sceneClosedButFilledImage:e.sceneAlmostOpenImage}};
"use strict";SharkGame.Home={tabId:"home",tabDiscovered:!0,tabSeen:!0,tabName:"Home Sea",tabBg:"img/bg/bg-homesea.png",currentButtonTab:null,currentExtraMessageIndex:null,buttonNamesList:[],extraMessages:{start:[{name:"start-you-are-a-shark",message:"You feel a bit hungry."},{name:"start-shark",unlock:{totalResource:{fish:5}},message:"You attract the attention of a shark. Maybe they can help you catch fish!"},{name:"start-sharks",unlock:{resource:{shark:2}},message:"More sharks swim over, curious and watchful."},{name:"start-ray",unlock:{resource:{shark:5}},message:"Some rays drift over."},{name:"start-quite-the-group",unlock:{resource:{shark:6,ray:2}},message:"You have quite the group going now."},{name:"start-crab",unlock:{resource:{shark:10,ray:4}},message:"Some curious crabs come over."},{name:"start-tribe",unlock:{resource:{shark:12,ray:4,crab:5}},message:"Your new tribe is at your command!"},{name:"start-crystals",unlock:{resource:{shark:1,crystal:10}},message:"The crystals are shiny. Some sharks stare at them curiously."},{name:"start-science",unlock:{resource:{scientist:1}},message:"The science sharks swim in their own school."},{name:"start-discoveries",unlock:{upgrade:["crystalContainer"]},message:"More discoveries are needed."},{name:"start-nurse",unlock:{resource:{nurse:1}},message:"The shark community grows with time."},{name:"start-exploration",unlock:{upgrade:["exploration"]},message:"You hear faint songs and cries in the distance."},{name:"start-machines",unlock:{upgrade:["automation"]},message:"Machines to do things for you.<br>Machines to do things faster than you or any shark."},{name:"start-chasm",unlock:{upgrade:["farExploration"]},message:"This place is not your home. You remember a crystal blue ocean.<br>The chasms beckon."},{name:"start-gate",unlock:{upgrade:["gateDiscovery"]},message:"The gate beckons. The secret must be unlocked."}],marine:[{name:"marine-default",message:"Schools of fish fill the vast expanse. This place feels so familiar."},{name:"marine-noticed-lobsters",unlock:{upgrade:["crystalContainer"]},message:"You notice some creatures on the ocean floor. They laze about and ignore your presence."},{name:"marine-noticed-lobsters-2",unlock:{upgrade:["seabedGeology"]},message:"You notice some creatures on the ocean floor. They laze about and ignore your presence."},{name:"marine-lobsters",unlock:{totalResource:{lobster:1}},message:"The lobsters work, but seem carefree. They worry about nothing."},{name:"marine-lobsters-talk",unlock:{totalResource:{lobster:125}},message:"When the lobsters talk, they speak of the good old days. They talk a lot."},{name:"marine-calcinium",unlock:{totalResource:{calcinium:1}},message:"Calcinium. It's rough, hard, and chalky. It feels fragile, but isn't."},{name:"marine-robotics",unlock:{totalResource:{clamScavenger:1}},message:"A cold, rough limb fishes clams out of the seabed. The lobsters watch intently."},{name:"marine-bioengineering",unlock:{upgrade:["bioengineering"]},message:"Stone-to-brain interface. Shelbernetic enhancements. Population automation. The lobsters say that calcinium is an extension of life itself."},{name:"marine-sentience",unlock:{upgrade:["sentientCircuitBoards"]},message:"All of us have boards now. Children are born half-machine. The lobsters call it effective."},{name:"marine-abandoned",unlock:{upgrade:["mobiusShells"]},message:"Murk spills out of the frenzy. A rancid fog begins to descend. This dying world drags everyone down with it."}],haven:[{name:"haven-default",message:"These oceans are rich with life. A thriving reef surrounds you."},{name:"haven-dolphin-observes",unlock:{totalResource:{coral:75}},message:"A... thing observes us from afar. What the heck is that??",scales:!0},{name:"haven-dolphins",unlock:{totalResource:{dolphin:1},homeAction:["getDolphin"]},message:"A dolphin joins the frenzy. We told it to go get fish, but it came back with coral. It insists that the coral is more valuable."},{name:"haven-dolphin-empire",unlock:{totalResource:{dolphin:20}},message:"The dolphin pods that work with us speak of a star-spanning empire of their kind. They ask where our empire is. And they smile.",scales:!0},{name:"haven-papyrus",unlock:{upgrade:["sunObservation"]},message:"Pieces of condensed kelp (???) are washing up in the currents.<br/>Something is carved into them."},{name:"haven-stories",unlock:{upgrade:["delphineHistory"]},message:"The dolphin's self-indulgent tales make frequent references to a mystical gate. And, they don't know where it is. Of course they don't."},{name:"haven-whales",unlock:{totalResource:{whale:1},homeAction:["getWhale"]},message:"The whales speak rarely to us, working in silence as they sing to the ocean. What do they sing for?"},{name:"haven-history",unlock:{upgrade:["retroactiveRecordkeeping"]},message:"The grand sum of all dolphin knowledge is laid out before us,<br/>and it is pitifully small. The original collections have been lost to time."},{name:"haven-song",unlock:{upgrade:["whaleSong"]},message:"The whale song fills you with the same feeling as the gates. But so much smaller."},{name:"haven-done",unlock:{resource:{chorus:1}},message:"The great song booms across the open water, carrying itself to all corners of the ocean.<br/>The gate reacts."}],tempestuous:[{name:"tempestuous-default",message:"The storm never ends, and many are lost to its violent throes."}],volcanic:[{name:"volcanic-default",message:"Scorching vents fill the sea with white and black smoke. There's not a shark in sight."},{name:"volcanic-shrimp-contact",unlock:{totalResource:{sponge:1}},message:"You are approached by a single shrimp. They relay a message to you: stop harvesting sponges, or face the wrath of the king of shrimps."},{name:"volcanic-shrimp-threat",unlock:{custom:()=>SharkGame.flags.prySpongeGained>200&&!SharkGame.flags.gotFarmsBeforeShrimpThreat},message:"You are approached by an army of shrimp. They relay a very clear message to you: cooperate, or be destroyed. You decide to stop harvesting sponges."},{name:"volcanic-shrimp-communication",unlock:{upgrade:["consistentCommunication"]},message:"The homes (sponges) left behind by shrimp joining the frenzy may now be taken for ourselves."},{name:"volcanic-monarchy",unlock:{totalResource:{queen:1}},message:"The shrimps follow a caste system with the king of shrimps on top. They ask who your king is."},{name:"volcanic-shrimps",unlock:{upgrade:["sustainableSolutions"]},message:"The shrimp speak of an ancient visitor who violated their world, and how they wish to restore it. They work hard for their future."},{name:"volcanic-smithing",unlock:{totalResource:{porite:1}},message:"Porite: glassy hunks sealed on the outside but porous on the inside: it's lightweight, yet it stays strong."},{name:"volcanic-noticed",unlock:{upgrade:["glassTempering"]},message:"The king has finally caught wind of your plans, rumors say. They say he plans to destroy the entire frenzy."},{name:"volcanic-acolytes",unlock:{upgrade:["algaeAcolytes"]},message:"The acolytes gather. They pray for their king. They pray for their world. They pray for you."},{name:"volcanic-beauty",unlock:{upgrade:["finalDraft"]},message:"The king is speechless. As he views the great industrial city, his subjects gather and cheer, celebrating his arrival."},{name:"volcanic-hope",unlock:{upgrade:["apologeticAmnesty"]},message:'"Perhaps not all sharks are so vile," says the king of shrimps. "Perhaps, you will be different."'}],abandoned:[{name:"abandoned-default",message:"The tar clogs the gills of everyone here. This dying world drags everyone down with it."},{name:"abandoned-octopus-scrutinizes",unlock:{upgrade:["statsDiscovery"]},message:"An octopus wanders over. It scrutinizes your attempt at organization."},{name:"abandoned-octopus",unlock:{totalResource:{octopus:1}},message:"The octopus works tirelessly."},{name:"abandoned-octopuses",unlock:{totalResource:{octopus:8}},message:"More octopuses join. They work in perfect unison."},{name:"abandoned-production",unlock:{upgrade:["octopusMethodology"]},message:"The octopuses speak of production and correct action. They speak of unity through efficiency. They regard us with cold, neutral eyes."},{name:"abandoned-spronge",unlock:{resource:{spronge:1}},message:"Residue pumps through spronge like blood. It pulses and throbs."},{name:"abandoned-exploration",unlock:{upgrade:["exploration"]},message:"Great spires loom in the distance. Loose cables are strung together on the horizon."},{name:"abandoned-gate",unlock:{upgrade:["farAbandonedExploration"]},message:"This gate stands inert and lifeless like the city around it. The slots are already filled, but it looks like it's turned off."},{name:"abandoned-reverse-engineering",unlock:{upgrade:["reverseEngineering"]},message:"The components spin and whirr and click together, but their purpose eludes us. What secrets are you hiding in your mechanisms?"},{name:"abandoned-high-energy-fusion",unlock:{upgrade:["highEnergyFusion"]},message:"The light is blinding, but the output is worth it. The pieces of a broken past unite to create a brighter future."},{name:"abandoned-done",unlock:{upgrade:["artifactAssembly"]},message:"..."},{name:"abandoned-tar-one",unlock:{resource:{tar:5}},message:"The tar is killing everything! Maybe a filter could save us?"},{name:"abandoned-tar-two",unlock:{resource:{tar:200}},message:"Only machines will remain. All is lost. <span class='smallDesc'>All is lost.</span>"}],shrouded:[{name:"shrouded-default",message:"The crystals are easier to find, but the darkness makes it hard to find anything else."},{name:"shrouded-eel-onlookers",unlock:{upgrade:["crystalContainer"]},message:"Divers have reported sightings of wiggly things on the ocean floor. They dart into their holes when approached."},{name:"shrouded-eels",unlock:{totalResource:{eel:1}},message:"The eels chatter among their hiding places. They like the sharks."},{name:"shrouded-distant-chimaeras",unlock:{upgrade:["exploration"]},message:"In the fog of darkness, the shapes of strange creatures can be made out. They dart away when light approaches."},{name:"shrouded-chimaeras",unlock:{totalResource:{chimaera:1}},message:"The chimaeras imply they are ancient kin of the shark kind, reunited through wild coincidence. We don't understand, but they seem to think we do."},{name:"shrouded-arcana",unlock:{totalResource:{arcana:5}},message:"These hadal artifacts glow faintly, only in pitch blackness. That glow makes you feel something that you don't understand."},{name:"shrouded-power",unlock:{totalResource:{sacrifice:100}},message:"Every broken shard disintegrates in a blinding flash of light. That familiar feeling washes over you with every sacrifice. The sharp snap of broken arcana echoes in your mind."},{name:"shrouded-city",unlock:{upgrade:["arcaneHeart"]},message:"The sounds of explorers echo endlessly through the tunnels of the broken city. The eels say they are filled with hope."},{name:"shrouded-truth",unlock:{totalResource:{sacrifice:9e15}},message:"A team of eels get your attention. They show you something that they found in the caverns. It's a book on making arcana."}],frigid:[{name:"frigid-default",message:"Giant shards of glassy ice surround you on all sides."},{name:"frigid-ice-one",unlock:{resource:{ice:100}},message:"You feel tired."},{name:"frigid-icy-doom",unlock:{resource:{ice:500}},message:"So cold. So hungry. <span class='smallDesc'>So hopeless.</span>"},{name:"frigid-distant-village",unlock:{totalResource:{science:8}},message:"While scanning the horizon, you notice a gap in the ice. You peer through it, and spot something else.",scales:!0},{name:"frigid-village",unlock:{upgrade:["civilContact"]},message:"A small village of squid greets you respectfully. The water in this place is a little warmer, and you hear a quiet, ambient hum."},{name:"frigid-urchins",unlock:{totalResource:{urchin:2}},message:"The urchins scuttle along the ground and hop about, gathering kelp and placing it into a large, central pile. They know nothing but the kelp."},{name:"frigid-teamwork",unlock:{totalResource:{extractionTeam:1}},message:"The squid champion the value of teamwork and the necessity of cooperation. They say they follow by example."},{name:"frigid-machine",unlock:{totalResource:{squid:125}},message:"In the center of the settlement lies a vibrating...thing, and a strange gate. The thing buzzes loudly, casting enormous energy across the water.",scales:!0},{name:"frigid-squid",unlock:{totalResource:{squid:250}},message:"The squid speak of an ancient visitor who saved their world. They ask if you too, have seen this visitor.",scales:!0},{name:"frigid-suspicion",unlock:{upgrade:["automation"]},message:"The squid describe the machine with fascination. They ask if we feel the same. They see something we do not."},{name:"frigid-battery",unlock:{upgrade:["internalInquiry"]},message:"Buried deep within the complex lies a massive, dimly glowing battery. The squid say replacing it will get the machine running at full power."},{name:"frigid-heat-returns",unlock:{upgrade:["rapidRecharging"]},message:"A wave of heat washes over you, and the dingy complex comes back to life. The gate turns on."}]},init(){SharkGame.TabHandler.registerTab(this),SharkGame.HomeActions.generated={},home.currentExtraMessageIndex=-1,home.currentButtonTab="all"},setup(){const e=SharkGame.WorldTypes[world.worldType].name+" Ocean";home.tabName=e,SharkGame.Tabs.home&&(SharkGame.Tabs.home.name=e),home.discoverActions()},switchTo(){this.buttonNamesList=[];const e=$("#content"),t=$("<div>").attr("id","tabMessage");e.append(t),home.currentExtraMessageIndex=-1,home.updateMessage(!0);const a=$("<div>").attr("id","homeTabs");e.append(a),home.createButtonTabs(),SharkGame.persistentFlags.revealedBuyButtons&&main.createBuyButtons("buy",e,"append");const s=$("<div>").attr("id","buttonList").addClass("homeScreen");e.append(s),SharkGame.Settings.current.showTabImages&&t.css("background-image","url('"+home.tabBg+"')"),this.update()},discoverActions(){$.each(SharkGame.HomeActions.getActionTable(),((e,t)=>{t.discovered=home.areActionPrereqsMet(e),t.newlyDiscovered=!1}))},createButtonTabs(){const e=$("#homeTabs"),t=$("<ul>").attr("id","homeTabsList");e.empty();let a=0;SharkGame.persistentFlags.revealedButtonTabs&&($.each(SharkGame.HomeActionCategories,((e,s)=>{const o=home.currentButtonTab===e;let r=!1;if(r="all"===e||_.some(s.actions,(e=>{const t=SharkGame.HomeActions.getActionTable();return _.has(t,e)&&t[e].discovered})),r){const r=$("<li>");o?r.html(s.name):(r.append($("<a>").attr("id","buttonTab-"+e).attr("href","javascript:;").html(s.name).on("click",(function(){if($(this).hasClass(".disabled"))return;const e=$(this).attr("id").split("-")[1];home.changeButtonTab(e)}))),s.hasNewItem&&r.addClass("newItemAdded")),t.append(r),a++}})),a>2&&e.append(t))},updateTab(e){if("all"===home.currentButtonTab)return;SharkGame.HomeActionCategories[e].hasNewItem=!0;const t=$("#buttonTab-"+e);t.length>0?t.parent().addClass("newItemAdded"):home.createButtonTabs()},changeButtonTab(e){SharkGame.HomeActionCategories[e].hasNewItem=!1,"all"===e&&_.each(SharkGame.HomeActionCategories,(e=>{e.hasNewItem=!1})),home.currentButtonTab=e,$("#buttonList").empty(),home.createButtonTabs(),home.update()},getButtonTabs(){const e=[];return $.each(SharkGame.HomeActionCategories,(t=>{($(`#buttonTab-${t}`).html()||home.currentButtonTab===t)&&e.push(t)})),e},getNextButtonTab(){const e=this.getButtonTabs(),t=e.indexOf(home.currentButtonTab);return t===e.length-1?e[0]:e[t+1]},getPreviousButtonTab(){const e=this.getButtonTabs(),t=e.indexOf(home.currentButtonTab);return 0===t?e[e.length-1]:e[t-1]},updateMessage(e){const t=SharkGame.WorldTypes[world.worldType],a=home.extraMessages[world.worldType],s=_.findLastIndex(a,(e=>{if(_.has(e,"unlock")){let t=!0;return t=t&&_.every(e.unlock.resource,((e,t)=>res.getResource(t)>=e)),t=t&&_.every(e.unlock.totalResource,((e,t)=>res.getTotalResource(t)>=e)),t=t&&_.every(e.unlock.upgrade,(e=>SharkGame.Upgrades.purchased.includes(e))),t=t&&_.every(e.unlock.homeAction,(e=>{const t=SharkGame.HomeActions.getActionData(SharkGame.HomeActions.getActionTable(),e);return t.discovered&&!t.newlyDiscovered})),e.unlock.custom&&(t=t&&e.unlock.custom()),t}return!0}));if(home.currentExtraMessageIndex!==s){home.currentExtraMessageIndex=s;const o=a[s],r=$("#tabMessage");let n;SharkGame.Settings.current.showTabImages&&(n=$("#tabSceneImage"),0===n.length&&(n=$("<div>").attr("id","tabSceneImage")));let i="<strong class='medDesc'>You are a shark in a "+t.shortDesc+" sea.</strong>";i+="<br><strong id='extraMessage'><br></strong>",r.html(i).prepend(n);const c=$("#extraMessage");!e&&SharkGame.Settings.current.showAnimations?(c.animate({opacity:0},200,(()=>{$(c).animate({opacity:1},200).html(o.message)})),n.animate({opacity:0},500,(()=>{SharkGame.Settings.current.showTabImages&&SharkGame.changeSprite(SharkGame.spriteHomeEventPath,o.name,n,"missing"),$(n).animate({opacity:1},500)}))):(c.html(a[s].message),SharkGame.Settings.current.showTabImages&&SharkGame.changeSprite(SharkGame.spriteHomeEventPath,o.name,n,"missing"))}},update(){$.each(SharkGame.HomeActions.getActionTable(),((e,t)=>{const a=home.getActionCategory(e);if((a===home.currentButtonTab||"all"===home.currentButtonTab)&&!t.isRemoved){0===$("#"+e).length?(t.discovered||home.areActionPrereqsMet(e))&&(t.discovered||(t.discovered=!0,t.newlyDiscovered=!0),home.addButton(e),home.createButtonTabs()):home.updateButton(e)}else t.discovered||home.areActionPrereqsMet(e)&&(t.discovered=!0,t.newlyDiscovered=!0,home.updateTab(a))})),home.updateMessage(),document.getElementById("tooltipbox").className.split(" ").includes("forHomeButtonOrGrotto")&&document.getElementById("tooltipbox").attributes.current&&home.onHomeHover(null,document.getElementById("tooltipbox").attributes.current.value)},updateButton(e){if(!sharkmath.getBuyAmount())return;const t=new Decimal(sharkmath.getBuyAmount()),a=$("#"+e),s=SharkGame.HomeActions.getActionData(SharkGame.HomeActions.getActionTable(),e);if(s.removedBy&&home.shouldRemoveHomeButton(s))return a.remove(),SharkGame.HomeActions.getActionTable()[e].isRemoved=!0,void(SharkGame.HomeActions.getActionTable()[e].discovered=!0);let o=t,r=!0;if(t.lessThan(0)){const e=home.getMax(s),a=new Decimal(1).dividedBy(t.times(-1));o=e.times(a),o.lessThan(1)&&(r=!!o.times(t.times(-1)).greaterThanOrEqualTo(1-SharkGame.EPSILON),o=new Decimal(1)),o=o.round()}const n=home.getCost(s,o);r&&(r=res.checkResources(n)),$.isEmptyObject(n)&&(r=!0);let i=s.name;if(!$.isEmptyObject(n)&&o.greaterThan(1)&&(i+=" ("+sharktext.beautify(o.toNumber())+")"),r?a.removeClass("disabled"):a.addClass("disabled"),_.some(n,(e=>!e.isFinite())))i+="<br>Maxed out";else{const t=sharktext.resourceListToString(n,!r,sharkcolor.getElementColor(e,"background-color"));""!==t&&(i+="<br>Cost: "+t)}if(i=$('<span id="'+e+'Label" class="click-passthrough">'+i+"</span>"),a.html().includes("button-icon")!==SharkGame.Settings.current.showIcons){let t;switch(a.html(i),e){case"getUrchin":t=Math.random()<.002?"actions/getUrchinHatted":"actions/getUrchin";break;case"getLobster":t=Math.random()<.002?"actions/getLobter":"actions/getLobster";break;default:t="actions/"+e}if(SharkGame.Settings.current.showIcons){const e=SharkGame.changeSprite(SharkGame.spriteIconPath,t,null,"general/missing-action");e&&(e.addClass("button-icon"),a.prepend(e))}}else{const t=$("#"+e+"Label");i.html()!==t.html()&&t.html(i.html())}},areActionPrereqsMet(e){const t=SharkGame.HomeActions.getActionData(SharkGame.HomeActions.getActionTable(),e);return!t.unauthorized&&(!_.isUndefined(t.unauthorized)||(!t.removedBy||!home.shouldRemoveHomeButton(t))&&(!(t.prereq.resource&&!res.checkResources(t.prereq.resource,!0))&&(!!_.every(t.cost,(e=>world.doesResourceExist(e.resource)))&&((!t.prereq.world||world.worldType===t.prereq.world)&&((!t.prereq.notWorlds||!t.prereq.notWorlds.includes(world.worldType))&&(!!_.every(t.prereq.upgrade,(e=>SharkGame.Upgrades.purchased.includes(e)))&&!!_.every(t.effect.resource,((e,t)=>world.doesResourceExist(t)))))))))},shouldHomeButtonBeUsable(e){let t=!0;return(cad.pause||cad.stop)&&(t=!1),t},shouldRemoveHomeButton(e){let t=!1;return $.each(e.removedBy,((e,a)=>{switch(e){case"totalResourceThreshold":t=t||_.some(a,(e=>res.getTotalResource(e.resource)>=e.threshold));break;case"otherActions":t=t||_.some(a,(e=>home.areActionPrereqsMet(e)));break;case"upgrades":t=t||_.some(a,(e=>SharkGame.Upgrades.purchased.includes(e)));break;case"custom":t=t||a()}})),t},addButton(e){this.buttonNamesList.push(e);const t=$("#buttonList"),a=SharkGame.HomeActions.getActionTable()[e],s=SharkGame.Button.makeHoverscriptButton(e,a.name,t,home.onHomeButton,home.onHomeHover,home.onHomeUnhover);s.html($("<span id='"+e+"Label' class='click-passthrough'></span>")),home.updateButton(e),SharkGame.Settings.current.showAnimations&&s.hide().css("opacity",0).slideDown(50).animate({opacity:1},50),home.shouldBeNewlyDiscovered(e,a)&&s.addClass("newlyDiscovered"),home.doesButtonGiveNegativeThing(a)&&s.addClass("gives-consumer")},doesButtonGiveNegativeThing(e){let t=!1;return $.each(e.effect.resource,(e=>{if(_.some(SharkGame.ResourceMap.get(e).income,((e,t)=>world.doesResourceExist(t)&&(e<0&&!res.isInCategory(t,"harmful")||res.isInCategory(t,"harmful")&&e>0))))return t=!0,!1})),t},shouldBeNewlyDiscovered(e,t){if(SharkGame.Aspects.pathOfTime.level){if("getCrab"===e&&world.doesResourceExist("crab"))return!1;if("getDiver"===e&&world.doesResourceExist("diver"))return!1}return t.newlyDiscovered},getActionCategory:e=>_.findKey(SharkGame.HomeActionCategories,(t=>_.some(t.actions,(t=>t===e)))),onHomeButton(e,t){const a=new Decimal(sharkmath.getBuyAmount());let s;if(t?s=$("#"+t):(s=$(this),t=s.attr("id")),SharkGame.Keybinds.bindMode)return SharkGame.Keybinds.settingAction=t,void SharkGame.Keybinds.updateBindModeState();if(s.hasClass("disabled"))return;const o=SharkGame.HomeActions.getActionData(SharkGame.HomeActions.getActionTable(),t);let r={},n=new Decimal(0);if(a.lessThan(0)){const e=home.getMax(o);if(!(e>0))return;{const t=new Decimal(1).dividedBy(a.times(-1));n=e.times(t),n=n.round(),n.lessThan(1)&&(n=new Decimal(1)),r=home.getCost(o,n)}}else r=home.getCost(o,a),n=a;if($.isEmptyObject(r)&&!n.equals(0))o.effect.resource&&res.changeManyResources(o.effect.resource),o.effect.events&&_.each(o.effect.events,(e=>{SharkGame.Events[e].trigger()})),log.addMessage(SharkGame.choose(o.outcomes));else if(n.greaterThan(0))if(o.effect.events&&_.each(o.effect.events,(e=>{SharkGame.Events[e].trigger()})),"transmuteSharkonium"===t&&(a.equals(1)?(SharkGame.persistentFlags.individuallyBoughtSharkonium||(SharkGame.persistentFlags.individuallyBoughtSharkonium=0),-1!==SharkGame.persistentFlags.individuallyBoughtSharkonium&&(SharkGame.persistentFlags.individuallyBoughtSharkonium+=1)):SharkGame.persistentFlags.individuallyBoughtSharkonium=-1),res.checkResources(r)){if(res.changeManyResources(r,!0),o.effect.resource){let e;e=n.equals(1)?o.effect.resource:res.scaleResourceList(o.effect.resource,n),res.changeManyResources(e)}!o.multiOutcomes||n.equals(1)?log.addMessage(SharkGame.choose(o.outcomes)):log.addMessage(SharkGame.choose(o.multiOutcomes))}else log.addMessage("You can't afford that!");s.hasClass("newlyDiscovered")&&(SharkGame.HomeActions.getActionTable()[t].newlyDiscovered=!1,s.removeClass("newlyDiscovered")),s.addClass("disabled")},onHomeHover(e,t){if(!SharkGame.Settings.current.showTooltips||!t&&!e||!main.shouldShowTooltips())return;if(!t){t=$(this).attr("id")}$("#tooltipbox").removeClass("gives-consumer");const a=SharkGame.HomeActions.getActionData(SharkGame.HomeActions.getActionTable(),t),s=a.effect,o={};$.each(s.resource,(e=>{$.each(SharkGame.ResourceMap.get(e).income,(t=>{const a=res.getProductAmountFromGeneratorResource(e,t,1);0!==a&&world.doesResourceExist(t)&&(o[t]=a)}))}));let r=1;!SharkGame.Settings.current.alwaysSingularTooltip&&a.cost.length>0&&!_.some(a.cost,(e=>"unique"===e.costFunction))&&(r=sharkmath.getPurchaseAmount(void 0,home.getMax(a).toNumber()),r<1&&(r=1));const n=_.some(s.resource,((e,t)=>sharktext.getDeterminer(t)))&&(r>1||_.some(s.resource,(e=>e>1)))||_.keys(s.resource).length>1;let i=!1,c="";_.some(o,(e=>e>0))&&(_.some(o,((e,t)=>e>0&&res.isInCategory(t,"harmful")))&&$("#tooltipbox").addClass("gives-consumer"),c+="<span class='littleTooltipText'>PRODUCE"+(n?"":"S")+"</span><br/>",i=!0),$.each(o,((e,t)=>{t>0&&(c+=sharktext.beautifyIncome(r*t," "+sharktext.getResourceName(e,!1,!1,sharkcolor.getElementColor("tooltipbox","background-color"))).bold()+"<br/>")})),_.some(o,(e=>e<0))&&(_.some(o,((e,t)=>e<0&&!res.isInCategory(t,"harmful")))&&$("#tooltipbox").addClass("gives-consumer"),c+="<span class='littleTooltipText'>"+(i?"and ":"")+"CONSUME"+(n?"":"S")+"</span><br/>",i=!0),$.each(o,((e,t)=>{t<0&&(c+=sharktext.beautifyIncome(-r*t," "+sharktext.getResourceName(e,!1,!1,sharkcolor.getElementColor("tooltipbox","background-color"))).bold()+"<br/>")}));const l=res.condenseNode(s.resource);$.isEmptyObject(l.resAffect.increase)||(_.some(o,((e,t)=>res.isInCategory(t,"harmful")))&&$("#tooltipbox").addClass("gives-consumer"),c+="<span class='littleTooltipText'>"+(i?"and ":"")+"INCREASE"+(n?"":"S")+"</span><br/>",i=!0,$.each(l.resAffect.increase,((e,t)=>{c+=sharktext.boldString("all ")+sharktext.getResourceName(e,!1,!1,sharkcolor.getElementColor("tooltipbox","background-color"))+sharktext.boldString(" gains ")+" by "+sharktext.boldString(sharktext.beautify(r*t*100)+"%")+"<br>"}))),$.isEmptyObject(l.resAffect.decrease)||(_.some(l.resAffect.decrease,((e,t)=>!res.isInCategory(t,"harmful")))&&$("#tooltipbox").addClass("gives-consumer"),c+="<span class='littleTooltipText'>"+(i?"and ":"")+"DECREASE"+(n?"":"S")+"</span><br/>",i=!0,$.each(l.resAffect.decrease,((e,t)=>{c+=sharktext.boldString("all ")+sharktext.getResourceName(e,!1,!1,sharkcolor.getElementColor("tooltipbox","background-color"))+sharktext.boldString(" gains ")+" by "+sharktext.boldString(sharktext.beautify(r*t*100)+"%")+"<br>"}))),$.isEmptyObject(l.resAffect.multincrease)||(_.some(l.resAffect.multincrease,((e,t)=>res.isInCategory(t,"harmful")))&&$("#tooltipbox").addClass("gives-consumer"),c+="<span class='littleTooltipText'>"+(i?"and ":"")+"MULTIPLICATIVELY INCREASE"+(n?"":"S")+"</span><br/>",i=!0,$.each(l.resAffect.multincrease,((e,t)=>{t=t**r-1,c+=sharktext.boldString("all ")+sharktext.getResourceName(e,!1,!1,sharkcolor.getElementColor("tooltipbox","background-color"))+sharktext.boldString(" gains ")+" by "+sharktext.boldString(sharkmath.beautif(100*t)+"%")+"<br>"}))),$.isEmptyObject(l.resAffect.multdecrease)||(_.some(l.resAffect.multdecrease,((e,t)=>!res.isInCategory(t,"harmful")))&&$("#tooltipbox").addClass("gives-consumer"),c+="<span class='littleTooltipText'>"+(i?"and ":"")+"MULTIPLICATIVELY DECREASE"+(n?"":"S")+"</span><br/>",i=!0,$.each(l.resAffect.multdecrease,((e,t)=>{t=1-t**r,c+=sharktext.boldString("all ")+sharktext.getResourceName(e,!1,!1,sharkcolor.getElementColor("tooltipbox","background-color"))+sharktext.boldString(" gains ")+" by "+sharktext.boldString(sharktext.beautify(100*t)+"%")+"<br>"}))),$.isEmptyObject(l.genAffect.increase)||(c+="<span class='littleTooltipText'>"+(i?"and ":"")+"INCREASE"+(n?"":"S")+"</span><br/>",i=!0,$.each(l.genAffect.increase,((e,t)=>{c+=sharktext.getResourceName(e,!1,!1,sharkcolor.getElementColor("tooltipbox","background-color"))+sharktext.boldString(" speed ")+" by "+sharktext.boldString(sharktext.beautify(r*t*100)+"%")+"<br>"}))),$.isEmptyObject(l.genAffect.decrease)||(c+="<span class='littleTooltipText'>"+(i?"and ":"")+"DECREASE"+(n?"":"S")+"</span><br/>",i=!0,$.each(l.genAffect.decrease,((e,t)=>{c+=sharktext.getResourceName(e,!1,!1,sharkcolor.getElementColor("tooltipbox","background-color"))+sharktext.boldString(" speed ")+" by "+sharktext.boldString(sharktext.beautify(r*t*100)+"%")+"<br>"}))),$.isEmptyObject(l.genAffect.multincrease)||(c+="<span class='littleTooltipText'>"+(i?"and ":"")+"MULTIPLICATIVELY INCREASE"+(n?"":"S")+"</span><br/>",i=!0,$.each(l.genAffect.multincrease,((e,t)=>{t=t**r-1,c+=sharktext.getResourceName(e,!1,!1,sharkcolor.getElementColor("tooltipbox","background-color"))+sharktext.boldString(" speed ")+" by "+sharktext.boldString(sharktext.beautify(100*t)+"%")+"<br>"}))),$.isEmptyObject(l.genAffect.multdecrease)||(c+="<span class='littleTooltipText'>"+(i?"and ":"")+"MULTIPLICATIVELY DECREASE"+(n?"":"S")+"</span><br/>",i=!0,$.each(l.genAffect.multdecrease,((e,t)=>{t=1-t**r,c+=sharktext.getResourceName(e,!1,!1,sharkcolor.getElementColor("tooltipbox","background-color"))+sharktext.boldString(" speed ")+" by "+sharktext.boldString(sharktext.beautify(100*t)+"%")+"<br>"}))),a.getSpecialTooltip&&(c+=a.getSpecialTooltip()+"<br>"),SharkGame.HomeActions.getActionTable()[t].helpText&&(c+="<hr class='hrForTooltipSeparation'><span class='medDesc'>"+SharkGame.HomeActions.getActionTable()[t].helpText+"</span>"),$.each(s.resource,((e,t)=>{if(r*t!=1)c=sharktext.beautify(r*t).bold()+" "+sharktext.getResourceName(e,!1,r*t,sharkcolor.getElementColor("tooltipbox","background-color")).bold()+"<br>"+(SharkGame.Settings.current.tooltipQuantityReminders?"<span class='medDesc littleTooltipText'>(you have "+sharktext.beautify(res.getResource(e))+")</span><br>":"")+c;else{const t=sharktext.getDeterminer(e);c=(t?t+" ":"")+sharktext.getResourceName(e,!1,1,sharkcolor.getElementColor("tooltipbox","background-color")).bold()+"<br>"+(SharkGame.Settings.current.tooltipQuantityReminders?"<span class='medDesc littleTooltipText'>(you have "+sharktext.beautify(res.getResource(e))+")</span><br>":"")+c}})),document.getElementById("tooltipbox").innerHTML!==c.replace(/'/g,'"').replace(/br\//g,"br")&&(document.getElementById("tooltipbox").innerHTML=c),$("#tooltipbox").attr("current")!==t?($("#tooltipbox").removeClass("forIncomeTable").attr("current",""),$("#tooltipbox").addClass("forHomeButtonOrGrotto").attr("current",t)):$("#tooltipbox").removeClass("forIncomeTable").addClass("forHomeButtonOrGrotto")},onHomeUnhover(){document.getElementById("tooltipbox").innerHTML="",$("#tooltipbox").removeClass("forHomeButtonOrGrotto").attr("current","").removeClass("gives-consumer")},getCost(e,t){const a={},s=e.cost;return _.each(s,(s=>{const o=SharkGame.PlayerResources.get(e.max),r=new Decimal(o.amount),n=new Decimal(s.priceIncrease);let i=new DecimalHalfRound(0);switch(s.costFunction){case"constant":i=sharkmath.constantCost(r,t,n);break;case"linear":i=sharkmath.linearCost(r,t,n);break;case"unique":i=sharkmath.uniqueCost(r,t,n)}i.abs().minus(i.round()).lessThan(SharkGame.EPSILON)&&(i=i.round()),a[s.resource]=i})),a},getMax(e){let t=new Decimal(1);if(e.max){const a=SharkGame.PlayerResources.get(e.max),s=new Decimal(a.amount);t=new Decimal(1e308),_.each(e.cost,(e=>{const a=new Decimal(SharkGame.PlayerResources.get(e.resource).amount),o=new Decimal(e.priceIncrease);let r=new DecimalHalfRound(-1);switch(e.costFunction){case"constant":r=sharkmath.constantMax("object"==typeof a?new Decimal(0):0,a,o);break;case"linear":r=sharkmath.linearMax(s,a,o).minus(s);break;case"unique":r=sharkmath.uniqueMax(s,a,o).minus(s)}r.minus(r.round()).abs().lessThan(SharkGame.EPSILON)&&(r=r.round()),r=new Decimal(r),t=Decimal.min(t,r)}))}return t.round()}};
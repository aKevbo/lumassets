"use strict";SharkGame.PlayerResources=new Map,SharkGame.PlayerIncomeTable=new Map,SharkGame.ResourceMap=new Map,SharkGame.BreakdownIncomeTable=new Map,SharkGame.FlippedBreakdownIncomeTable=new Map,SharkGame.ModifierMap=new Map,SharkGame.ResourceIncomeAffectors={},SharkGame.GeneratorIncomeAffectors={},SharkGame.Resources={INCOME_COLOR:"#909090",TOTAL_INCOME_COLOR:"#A0A0A0",UPGRADE_MULTIPLIER_COLOR:"#60A060",WORLD_MULTIPLIER_COLOR:"#6060A0",ASPECT_MULTIPLIER_COLOR:"#70B5A0",RESOURCE_AFFECT_MULTIPLIER_COLOR:"#BFBF5A",specialMultiplier:null,rebuildTable:!1,collapsedRows:new Set,init(){$.each(SharkGame.ResourceTable,((e,a)=>{const r=_.cloneDeep(a);r.name&&Object.defineProperty(r,"name",Object.getOwnPropertyDescriptor(SharkGame.ResourceTable[e],"name")),r.singleName&&Object.defineProperty(r,"singleName",Object.getOwnPropertyDescriptor(SharkGame.ResourceTable[e],"singleName")),r.desc&&Object.defineProperty(r,"desc",Object.getOwnPropertyDescriptor(SharkGame.ResourceTable[e],"desc")),SharkGame.ResourceMap.set(e,r)})),SharkGame.ResourceMap.forEach(((e,a)=>{e.income&&(e.baseIncome={},Object.defineProperties(e.baseIncome,Object.getOwnPropertyDescriptors(SharkGame.ResourceTable[a].income))),SharkGame.PlayerResources.set(a,{amount:0,totalAmount:0}),SharkGame.FlippedBreakdownIncomeTable.set(a,{}),SharkGame.PlayerIncomeTable.set(a,0)}));const e={};$.each(SharkGame.ModifierTypes,((a,r)=>{e[a]={},$.each(r,((r,t)=>{e[a][r]={},$.each(t,((t,s)=>{s.category=a,s.type=r,SharkGame.ModifierReference.set(t,s),e[a][r][t]=s.defaultValue}))}))})),SharkGame.ResourceMap.forEach(((a,r)=>{SharkGame.ModifierMap.set(r,_.cloneDeep(e))})),res.idleMultiplier=1,res.specialMultiplier=1,SharkGame.ResourceIncomeAffectors=_.cloneDeep(SharkGame.ResourceIncomeAffectorsOriginal),SharkGame.GeneratorIncomeAffectors=_.cloneDeep(SharkGame.GeneratorIncomeAffectorsOriginal),res.clearNetworks()},setup(){SharkGame.ResourceMap.forEach(((e,a)=>{$.each(e.baseIncome,(e=>{res.reapplyModifiers(a,e)}))})),res.recalculateIncomeTable(),res.reconstructResourcesTable()},processIncomes(e,a,r){if(res.recalculateIncomeTable(!0),!res.testGracePeriod()){if(SharkGame.timestampSimulated=r?SharkGame.timestampLastSave:_.now()-1e3*e,!a&&e>61){for(let a=0;a<60;a++)SharkGame.EventHandler.handleEventTick("beforeTick"),SharkGame.PlayerIncomeTable.forEach(((e,a)=>{res.changeResource(a,e)})),res.recalculateIncomeTable(!0),e-=1,SharkGame.timestampSimulated+=1e3,SharkGame.EventHandler.handleEventTick("afterTick");e>172800&&(e=res.doRKMethod(e,e/1728,5e4)),e>43200&&(e=res.doRKMethod(e,100,8e3)),e>7200&&(e=res.doRKMethod(e,75,2250)),e>2e3&&(e=res.doRKMethod(e,40,500)),e>60&&(e=res.doRKMethod(e,20,50))}for(SharkGame.timestampSimulated=_.now()-1e3*e;e>1;)SharkGame.EventHandler.handleEventTick("beforeTick"),SharkGame.PlayerIncomeTable.forEach(((e,a)=>{SharkGame.ResourceSpecialProperties.timeImmune.includes(a),res.changeResource(a,e)})),res.recalculateIncomeTable(!0),e-=1,SharkGame.timestampSimulated+=1e3,SharkGame.EventHandler.handleEventTick("afterTick");SharkGame.PlayerIncomeTable.forEach(((a,r)=>{SharkGame.ResourceSpecialProperties.timeImmune.includes(r)?res.changeResource(r,a):res.changeResource(r,a*e)})),res.recalculateIncomeTable()}},doRKMethod(e,a,r){let t,s,o,n;for(;e>r;)t=_.cloneDeep(SharkGame.PlayerResources),s=_.cloneDeep(SharkGame.PlayerIncomeTable),SharkGame.PlayerIncomeTable.forEach(((e,r)=>{SharkGame.ResourceSpecialProperties.timeImmune.includes(r)||res.changeResource(r,e*a/2,!0)})),res.recalculateIncomeTable(!0),o=_.cloneDeep(SharkGame.PlayerIncomeTable),SharkGame.PlayerIncomeTable.forEach(((e,r)=>{SharkGame.ResourceSpecialProperties.timeImmune.includes(r)||res.changeResource(r,e*a/2,!0)})),res.recalculateIncomeTable(!0),n=_.cloneDeep(SharkGame.PlayerIncomeTable),SharkGame.PlayerIncomeTable.forEach(((e,r)=>{SharkGame.ResourceSpecialProperties.timeImmune.includes(r)||res.changeResource(r,e*a,!0)})),res.recalculateIncomeTable(!0),SharkGame.PlayerResources=t,SharkGame.PlayerIncomeTable.forEach(((e,r)=>{res.changeResource(r,a*(s.get(r)+2*o.get(r)+2*n.get(r)+SharkGame.PlayerIncomeTable.get(r))/6,!0)})),res.recalculateIncomeTable(!0),e-=a;return e},recalculateIncomeTable(e){SharkGame.ResourceMap.forEach(((e,a)=>{SharkGame.PlayerIncomeTable.set(a,0)})),SharkGame.ResourceMap.forEach(((a,r)=>{if(world.doesResourceExist(r)&&a.income){let t=1;const s=new Map;if($.each(a.income,(e=>{world.doesResourceExist(e)&&s.set(e,res.getProductAmountFromGeneratorResource(r,e))})),s.forEach(((e,r)=>{if(!a.forceIncome&&e<0){const a=res.getResource(r);if(a+e<=0){const r=a/-e;t=r>=0&&r<1?Math.min(t,r):0}}e>0&&(SharkGame.PlayerResources.get(r).discovered=!0)})),e)s.forEach(((e,a)=>{SharkGame.PlayerIncomeTable.set(a,SharkGame.PlayerIncomeTable.get(a)+e*t)}));else{const e={};let a;s.forEach(((s,o)=>{a=s*t,e[o]=a,SharkGame.FlippedBreakdownIncomeTable.get(o)[r]=a,SharkGame.PlayerIncomeTable.set(o,SharkGame.PlayerIncomeTable.get(o)+a)})),SharkGame.BreakdownIncomeTable.set(r,e)}}})),$.each(SharkGame.ResourceSpecialProperties.incomeCap,((e,a)=>{SharkGame.PlayerIncomeTable.get(e)>a&&SharkGame.PlayerIncomeTable.set(e,a)}))},getProductAmountFromGeneratorResource(e,a,r=res.getResource(e)){const t=SharkGame.ResourceMap.get(e).income[a];return t*r*res.getSpecialMultiplier()*res.getNetworkIncomeModifier("generator",e)*res.getNetworkIncomeModifier("resource",a,t)*cad.speed*res.idleMultiplier/SharkGame.persistentFlags.dialSetting},getNetworkIncomeModifier(e,a,r){switch(e){case"generator":e=SharkGame.GeneratorIncomeAffected;break;case"resource":if(e=SharkGame.ResourceIncomeAffected,r&&r<0)return 1}const t=e[a];let s=1;return t&&(t.multiply&&$.each(t.multiply,((e,a)=>{s*=1+a*res.getResource(e)})),t.reciprocate&&$.each(t.reciprocate,((e,a)=>{s/=1+a*res.getResource(e)})),t.exponentiate&&$.each(t.exponentiate,((e,a)=>{s*=Math.pow(a,res.getResource(e))})),t.polynomial&&$.each(t.polynomial,((e,a)=>{s*=1+Math.pow(res.getResource(e),a)}))),s},getSpecialMultiplier:()=>res.specialMultiplier,getIncome:e=>SharkGame.PlayerIncomeTable.get(e),changeResource(e,a,r){if(Math.abs(a)<SharkGame.EPSILON)return;const t=SharkGame.PlayerResources.get(e),s=t.totalAmount;world.doesResourceExist(e)&&(t.amount+=a,t.amount<0?t.amount=0:t.amount<SharkGame.MAX||(t.amount=SharkGame.MAX),a>0&&(t.totalAmount+=a),s<SharkGame.EPSILON&&a>0&&(res.rebuildTable=!0),r||res.recalculateIncomeTable())},setResource(e,a){const r=SharkGame.PlayerResources.get(e);r.amount=a,r.amount<0&&(r.amount=0),res.recalculateIncomeTable()},setTotalResource(e,a){SharkGame.PlayerResources.get(e).totalAmount=a},getResource:e=>SharkGame.PlayerResources.get(e).amount,getTotalResource:e=>SharkGame.PlayerResources.get(e).totalAmount,isCategoryVisible:e=>"Hidden"!==e.name&&_.some(e.resources,(e=>{const a=SharkGame.PlayerResources.get(e);return(a.totalAmount>0||a.discovered)&&world.doesResourceExist(e)})),getCategoryOfResource:e=>_.findKey(SharkGame.ResourceCategories,(a=>_.some(a.resources,(a=>a===e)))),getResourcesInCategory(e){const a=[];return SharkGame.ResourceCategories[e].resources.forEach((e=>a.push(e))),a},isCategory:e=>void 0!==SharkGame.ResourceCategories[e],isInCategory:(e,a)=>-1!==SharkGame.ResourceCategories[a].resources.indexOf(e),getBaseOfResource(e){for(const[a,r]of SharkGame.ResourceMap)if(_.some(r.jobs,(a=>a===e)))return a;return null},haveAnyResources(){for(const[e,a]of SharkGame.PlayerResources)if("world"!==e&&"aspectAffect"!==e&&a.totalAmount>0)return!0;return!1},checkResources:(e,a)=>_.every(e,((e,r)=>{const t=a?res.getTotalResource(r):res.getResource(r);return"object"==typeof e?e.lessThanOrEqualTo(t*(1+SharkGame.EPSILON)):t>=e})),changeManyResources(e,a=!1){$.each(e,((e,r)=>{"object"==typeof r&&(r=r.toNumber()),res.changeResource(e,a?-r:r)}))},scaleResourceList(e,a){const r={};return $.each(e,((e,t)=>{r[e]=t*a})),r},updateResourcesTable(){res.rebuildTable?res.reconstructResourcesTable():SharkGame.PlayerResources.forEach(((e,a)=>{const r=$("#amount-"+a).html(),t="⠀"+sharktext.beautify(e.amount,!0);r!==t.replace(/'/g,'"')&&$("#amount-"+a).html(t);const s=res.getIncome(a);if(Math.abs(s)>SharkGame.EPSILON){const e=s>0?"+":"",r="⠀<span class='click-passthrough' style='color:"+res.INCOME_COLOR+"'>"+e+sharktext.beautifyIncome(s)+"</span>";$("#income-"+a).html()!==r.replace(/'/g,'"')&&$("#income-"+a).html(r)}else $("#income-"+a).html("")}))},tokens:{list:[],chromeForcesWorkarounds:"",init(){for(SharkGame.flags.tokens||(SharkGame.flags.tokens={}),this.list.length>SharkGame.Aspects.tokenOfIndustry.level&&(this.list=[],$("#token-div").empty());this.list.length<SharkGame.Aspects.tokenOfIndustry.level;)this.makeToken();_.each(this.list,(e=>{SharkGame.flags.tokens[e.attr("id")]||(SharkGame.flags.tokens[e.attr("id")]="RETURNME"),$("#token-div").append(e.on("dragstart",res.tokens.handleTokenDragStart).on("dragover",(e=>{e.originalEvent.preventDefault()})).on("dragend",res.tokens.handleDragEnd).on("drop",res.tokens.dropToken).on("click",res.tokens.tryReturnToken).on("mouseenter",res.tokens.tooltip).on("mouseleave",res.tableTextLeave)),"NA"!==SharkGame.flags.tokens[e.attr("id")]&&"RETURNME"!==SharkGame.flags.tokens[e.attr("id")]&&world.doesResourceExist(SharkGame.flags.tokens[e.attr("id")].split("-")[1])?(res.tokens.markLocation(e.attr("id"),SharkGame.flags.tokens[e.attr("id")]),res.tokens.unmarkLocation("NA",e.attr("id"))):res.tokens.tryReturnToken(null,!0,e)})),res.tokens.updateTokenDescriptions()},makeToken(e="nobody cares",a="NA"){const r="token-"+(this.list.length+1),t=SharkGame.changeSprite(SharkGame.spriteIconPath,"general/theToken",null,"general/missing-action").attr("id",r).attr("type",e).attr("draggable",!0).addClass("token");return this.list.push(t),SharkGame.flags.tokens[r]||(SharkGame.flags.tokens[r]=a),t},tooltip(e){SharkGame.Settings.current.showTooltips&&("NA"===SharkGame.flags.tokens[this.id]?$("#tooltipbox").html(sharktext.boldString("Drag this token onto stuff to increase production.<br><br>While a token is still in its slot, you can also click where you want it to go.")).addClass("forHomeButtonOrGrotto"):$("#tooltipbox").html(sharktext.boldString("Click this slot or click the token to recall it.")).addClass("forHomeButtonOrGrotto"))},tryReturnToken(e,a,r=$("#"+this.id)){if(!r.length)return log.addError("Tried to return token, but couldn't find it!"),void log.addError("Tried to find this token: "+r.attr("id"));"NA"!==SharkGame.flags.tokens[r.attr("id")]&&(a||"RETURNME"===SharkGame.flags.tokens[r.attr("id")]||res.tokens.unmarkLocation(SharkGame.flags.tokens[r.attr("id")],r.attr("id")),SharkGame.changeSprite(SharkGame.spriteIconPath,"general/theToken",r,"general/missing-action"),r.attr("draggable",!0),SharkGame.flags.tokens[r.attr("id")]="NA",res.tokens.updateTokenDescriptions(),res.tableTextLeave())},handleTokenDragStart(e){e.originalEvent.dataTransfer.setData("tokenId",e.originalEvent.target.id),res.tokens.chromeForcesWorkarounds=e.originalEvent.target.id,e.originalEvent.dataTransfer.setData("tokenLocation",SharkGame.flags.tokens[this.id]);const a=document.createElement("img");a.src="img/raw/general/theToken.png",e.originalEvent.dataTransfer.setDragImage(a,0,0),res.tokens.updateColorfulDropZones(),res.tableTextLeave()},handleResourceDragStart(e){e.originalEvent.dataTransfer.setData("tokenId",$("#"+this.id).attr("tokenId")),res.tokens.chromeForcesWorkarounds=$("#"+this.id).attr("tokenId"),e.originalEvent.dataTransfer.setData("tokenLocation",e.originalEvent.target.id);const a=document.createElement("img");a.src="img/raw/general/theToken.png",e.originalEvent.dataTransfer.setDragImage(a,0,0),res.tokens.updateColorfulDropZones(),res.tableTextLeave()},handleDragEnd(e){res.tokens.chromeForcesWorkarounds="",res.tokens.updateColorfulDropZones()},updateColorfulDropZones(){SharkGame.ResourceMap.forEach(((e,a)=>{world.doesResourceExist(a)&&res.tokens.chromeForcesWorkarounds?(!$.isEmptyObject($("#resource-"+a))&&res.tokens.canBePlacedOn("resource-"+a)&&$("#resource-"+a).addClass("highlightedResource"),!$.isEmptyObject($("#income-"+a))&&res.tokens.canBePlacedOn("income-"+a)&&$("#income-"+a).addClass("highlightedIncome")):($("#resource-"+a).removeClass("highlightedResource"),$("#income-"+a).removeClass("highlightedIncome"))}))},updateTokenDescriptions(){if(SharkGame.Settings.current.verboseTokenDescriptions){let e="";_.each(res.tokens.list,(a=>{let r;if(e&&(e+="<br>"),e+="Token #"+a.attr("id").split("-")[1]+" is ",SharkGame.flags.tokens&&(r=SharkGame.flags.tokens[a.attr("id")]),_.isUndefined(r))return e="",!1;"NA"===r?e+="in its slot.":r.includes("income")?e+="boosting all "+r.split("-")[1]+" gains.":r.includes("resource")&&(e+="boosting "+r.split("-")[1]+" efficiency.")})),$("#token-description").html(e)}else $("#token-description").html("")},reapplyToken(e){SharkGame.flags.tokens&&$("#"+SharkGame.flags.tokens[e.attr("id")]).css("background-image","url(img/raw/general/theToken.png)").attr("draggable",!0).attr("tokenId",e.attr("id"))},dropToken(e){res.tableTextLeave();const a=e.originalEvent.dataTransfer.getData("tokenId"),r=e.originalEvent.dataTransfer.getData("tokenLocation");res.tokens.unmarkLocation(r,a),this.id.includes("token")&&this.id!==a?res.tokens.markLocation(a,a):res.tokens.markLocation(a,this.id),res.updateResourcesTable()},markLocation(e,a){res.tokens.applyTokenEffect(a,e,"apply"),a.includes("token")?(SharkGame.changeSprite(SharkGame.spriteIconPath,"general/theToken",$("#"+a),"general/missing-action"),$("#"+a).attr("draggable",!0),SharkGame.flags.tokens[a]="NA"):($("#"+a).css("background-image","url(img/raw/general/theToken.png)").attr("draggable",!0).attr("tokenId",e),SharkGame.flags.tokens[e]=a),res.tokens.updateTokenDescriptions()},unmarkLocation(e,a){"NA"===e?(SharkGame.changeSprite(SharkGame.spriteIconPath,"general/holeoverlay",$("#"+a),"general/missing-action"),$("#"+a).attr("draggable",!1)):$("#"+e).attr("draggable",!1).attr("tokenId","").css("background-image",""),res.tokens.applyTokenEffect(e,a,"reverse")},applyTokenEffect(e,a,r="apply"){const t=(SharkGame.Aspects.coordinatedCooperation.level+2)*(SharkGame.Aspects.collectiveCooperation.level+1);"NA"===e||e.includes("token")||(e.includes("resource")?res.applyModifier("theTokenForGenerators",e.split("-")[1],"apply"===r?t:1/t):e.includes("income")?res.applyModifier("theTokenForResources",e.split("-")[1],"apply"===r?t:1/t):(SharkGame.Log.addError("Tried to apply token effect, but couldn't understand the location!"),SharkGame.Log.addError("Location was: "+e)))},canBePlacedOn(e){const a=e.split("-")[1];return e.includes("resource")?!$("#"+e).attr("tokenId")&&_.some(SharkGame.ResourceMap.get(a).income,((e,a)=>0!==e&&world.doesResourceExist(a))):e.includes("income")?!$("#"+e).attr("tokenId")&&SharkGame.PlayerIncomeTable.get(a):void 0},tryClickToPlace(e){const a=e.originalEvent.target.id;res.tokens.canBePlacedOn(a)?$.each(SharkGame.flags.tokens,((e,r)=>{if("NA"===r)return res.tokens.markLocation(e,a),res.tokens.unmarkLocation("NA",e),!1})):$("#"+a).attr("tokenId")&&(res.tokens.markLocation($("#"+a).attr("tokenId"),$("#"+a).attr("tokenId")),res.tokens.unmarkLocation(a,$("#"+a).attr("tokenId")))}},minuteHand:{active:!1,disableNextTick:!1,realMultiplier:1,onMessages:["Time warps around you.","Everything seems to get faster.","Your vision warps as time bends.","The hands of a nearby clock speed up.","Frenzy members acclerate around you.","You feel strange. Everything feels wrong. It's so fast.","A strange feeling washes over you, and everything around you speeds up.","You feel your mind twisting. Churning. Everything seems so fast.","Things start piling up around you. You can't even tell who's doing it.","You feel a crushing weight on your mind, and everything seems to get faster.","You feel groggy. Everything speeds up.","You can barely understand what's happening around you anymore. The speed is jarring.","You feel sluggish. Everything around you seems so much faster.","Your vision gets blurry. Everything is blurry. It's all a blur.","Time seems to stretch from your perspective. It feels so wrong.","An otherworldly sensation overcomes you.","Confusion and distress overtake you as the hands of time speed up.","You float in place, taking in the sights as beautiful colors buzz by and the light of day flashes against night.","You feel disconnected, like you've been unplugged from the world. Time whizzes by.","You approach what feels like an edge: like you could tip over at any moment, and fall deep into the abyss.","What is this? What's going on? Everything feels like it's spinning."],offMessages:["You feel a headache coming on as time slows down again.","You feel a weight lifting as time slows down.","You breathe a sigh of relief as the world returns to normal.","Compared to how fast it just was, everything seems to grind to a halt.","Clarity washes over you. You feel alert, aware, as everything goes back to normal.","The forcible time-warp stops.","You feel your senses return to you like the sudden snap of a rubber band.","You are now keenly aware of what's around you as it all slows down.","You shake your head furiously, clearing the sluggishness from your mind. You feel normal again.","Your field of view warps significantly. Just how much were you even able to see? You can't remember.","You simply float right where you are, still coming to your senses.","Your vision sharpens. Your senses are keen. You can feel everything again.","You come back from the brink, exhaustion replaced by energy and enthusiasm."],allowMinuteHand(){SharkGame.persistentFlags.everIdled=!0,0===$("#minute-hand-toggle").length&&this.setup()},init(){res.minuteHand.realMultiplier=1,SharkGame.persistentFlags.everIdled=!1,SharkGame.flags.minuteHandTimer=0,SharkGame.flags.bonusTime=0,SharkGame.flags.hourHandLeft=0,SharkGame.persistentFlags.selectedMultiplier=2,this.active=!1,this.changeSelectedMultiplier(null,SharkGame.persistentFlags.selectedMultiplier),$("#minute-hand-div").empty()},setup(){_.isUndefined(SharkGame.flags.minuteHandTimer)&&(SharkGame.flags.minuteHandTimer=0),_.isUndefined(SharkGame.flags.hourHandLeft)&&(SharkGame.flags.hourHandLeft=0),SharkGame.persistentFlags.everIdled?0===$("#minute-hand-toggle").length&&(this.buildUI(),this.changeSelectedMultiplier(null,SharkGame.persistentFlags.selectedMultiplier),this.updateMinuteHandLabel()):$("#minute-hand-div").empty()},buildUI(){SharkGame.Button.makeHoverscriptButton("minute-hand-toggle","my cool button",$("#minute-hand-div"),res.minuteHand.toggleMinuteHand,res.minuteHand.showTooltip,res.tableTextLeave),$("#minute-hand-toggle").html("<strong>TOGGLE</strong>"),$("#minute-hand-div").append($("<div>").attr("id","minute-row-two")),$("#minute-row-two").append($("<span>").attr("id","minute-multiplier")),$("#minute-hand-div").append($("<div>").attr("id","minute-time")),$("#minute-row-two").append($("<span>").html("("));const e=$("<input>").attr("id","minute-slider").attr("type","range").attr("min",1).attr("max",9).attr("step",1).attr("value",Math.log2(SharkGame.persistentFlags.selectedMultiplier)).on("input",res.minuteHand.changeSelectedMultiplier);$("#minute-row-two").append(e),$("#minute-row-two").append($("<span>").html(") <strong>SPEED</strong>")),$("#minute-row-two").append($("<div>").attr("id","minute-pause")),SharkGame.Aspects.meditation.level&&SharkGame.Button.makeHoverscriptButton("pause-toggle","||",$("#minute-pause"),res.pause.togglePause,res.pause.showTooltip,res.tableTextLeave),$("#pause-toggle").addClass("close-button min")},updateMinuteHand(e){if("number"==typeof SharkGame.flags.minuteHandTimer){if(res.minuteHand.disableNextTick)res.minuteHand.disableNextTick=!1,res.minuteHand.active&&res.minuteHand.toggleMinuteHand();else if(res.minuteHand.active){const a=e*(res.minuteHand.realMultiplier-1);SharkGame.flags.hourHandLeft>0?SharkGame.flags.hourHandLeft-=a:SharkGame.flags.requestedTimeLeft>0&&(SharkGame.flags.requestedTimeLeft-=a),SharkGame.flags.hourHandLeft<0&&(SharkGame.flags.hourHandLeft=0),SharkGame.flags.requestedTimeLeft<0&&(SharkGame.flags.requestedTimeLeft=0),SharkGame.flags.minuteHandTimer-=a,SharkGame.flags.minuteHandTimer<0&&(res.minuteHand.disableNextTick=!0,res.minuteHand.changeRealMultiplier(SharkGame.flags.minuteHandTimer/e+res.minuteHand.realMultiplier-1),SharkGame.flags.minuteHandTimer=0,res.minuteHand.toggleMinuteHand())}else SharkGame.flags.minuteHandTimer+=e*(1+SharkGame.Aspects.doubleTime.level),res.minuteHand.addBonusTime(e*SharkGame.Aspects.doubleTime.level);res.minuteHand.updateMinuteHandLabel()}},toggleMinuteHand(){!res.minuteHand.active&&SharkGame.flags.minuteHandTimer>0?(main.endIdle(),cad.pause&&res.pause.togglePause(),res.minuteHand.active=!0,res.minuteHand.changeRealMultiplier(SharkGame.persistentFlags.selectedMultiplier),$("#minute-hand-toggle").addClass("minuteOn"),log.addMessage("<span class='minuteOn'>"+SharkGame.choose(res.minuteHand.onMessages)+"</span>")):res.minuteHand.active&&(res.minuteHand.active=!1,res.minuteHand.changeRealMultiplier(1),$("#minute-hand-toggle").removeClass("minuteOn"),log.addMessage("<span class='minuteOff'>"+SharkGame.choose(res.minuteHand.offMessages)+"</span>")),res.minuteHand.updateDisplay()},changeSelectedMultiplier(e,a){let r=SharkGame.persistentFlags.selectedMultiplier;r=a||2**Math.floor(document.getElementById("minute-slider").value),SharkGame.persistentFlags.selectedMultiplier=r,res.minuteHand.active&&res.minuteHand.changeRealMultiplier(r),res.minuteHand.updateDisplay()},changeRealMultiplier(e){0===e&&(e=1),res.specialMultiplier/=res.minuteHand.realMultiplier,res.minuteHand.realMultiplier=e,res.specialMultiplier*=res.minuteHand.realMultiplier},updateDisplay(){res.minuteHand.updateMinuteHandLabel(),SharkGame.Settings.current.minuteHandEffects&&res.minuteHand.updatePowers()},updateMinuteHandLabel(){const e=SharkGame.persistentFlags.selectedMultiplier.toString().padStart(3," ").replaceAll(" ","&nbsp;&nbsp;");$("#minute-multiplier").html("<span class='click-passthrough bold'>"+e+"×</span>"),$("#minute-time").html(sharktext.boldString("("+res.minuteHand.formatMinuteTime(SharkGame.flags.minuteHandTimer)+")")),SharkGame.flags.minuteHandTimer<100?($("#minute-hand-toggle").addClass("disabled"),$("#minute-time").addClass("noTime")):($("#minute-hand-toggle").removeClass("disabled"),$("#minute-time").removeClass("noTime"))},applyHourHand(){const e=6e4*SharkGame.Aspects.theHourHand.level;SharkGame.flags.hourHandLeft=e,SharkGame.flags.minuteHandTimer+=e,this.updateDisplay()},giveRequestedTime(){SharkGame.persistentFlags.requestedTime&&(SharkGame.flags.minuteHandTimer+=SharkGame.persistentFlags.requestedTime,this.addBonusTime(SharkGame.persistentFlags.requestedTime),SharkGame.flags.requestedTimeLeft=SharkGame.persistentFlags.requestedTime,SharkGame.Log.addMessage(`Took ${this.formatMinuteTime(SharkGame.persistentFlags.requestedTime)} out of storage.`),SharkGame.persistentFlags.requestedTime=0),this.updateDisplay()},formatMinuteTime(e,a){const r=Math.floor(e/100)/10,t=Math.floor(r/60),s=Math.floor(t/60),o=Math.floor(s/24),n=Math.floor(o/7),i=Math.floor(n/4),l=Math.floor(i/12);return(l>0?l+"Y, ":"")+(i>0?i%12+"M, ":"")+(n>0?n%4+"W, ":"")+(o>0?o%7+"D, ":"")+(s>0?s%24+"h ":"")+(t>0?t%60+"m ":"")+((r>=60||a?Math.round(r%60):(r%60).toFixed(1))+"s")},updatePowers(){if($("#minute-slider").removeClass("power1").removeClass("power2").removeClass("power3").removeClass("power4").removeClass("power5"),$("#minute-hand-toggle").removeClass("power1").removeClass("power2").removeClass("power3").removeClass("power4").removeClass("power5"),res.minuteHand.active&&SharkGame.Settings.current.minuteHandEffects){const e=2**Math.floor(document.getElementById("minute-slider").value);2===e?($("#minute-slider").addClass("power1"),$("#minute-hand-toggle").addClass("power1")):e>2&&e<=16?($("#minute-slider").addClass("power2"),$("#minute-hand-toggle").addClass("power2")):e>16&&e<=64?($("#minute-slider").addClass("power3"),$("#minute-hand-toggle").addClass("power3")):e>64&&e<=256?($("#minute-slider").addClass("power4"),$("#minute-hand-toggle").addClass("power4")):512===e&&($("#minute-slider").addClass("power5"),$("#minute-hand-toggle").addClass("power5"))}},showTooltip(){SharkGame.Settings.current.showTooltips&&(SharkGame.Settings.current.idleEnabled?$("#tooltipbox").html("This is the <strong>minute hand</strong>.<br>It stores offline and idle progress.<br><br>Use the slider to adjust speed.<br>Press the button to unleash it."):$("#tooltipbox").html("This is the <strong>minute hand</strong>.<br>It stores time from various sources.<br><br>Use the slider to adjust speed.<br>Press the button to unleash it."))},toggleOff(){res.minuteHand.active&&res.minuteHand.toggleMinuteHand()},addBonusTime(e){SharkGame.flags.bonusTime||(SharkGame.flags.bonusTime=0),SharkGame.flags.bonusTime+=e}},pause:{init(){cad.pause&&this.togglePause()},togglePause(){cad.pause?($("#pause-toggle").removeClass("on"),cad.pause=!1,SharkGame.persistentFlags.pause=!1):($("#pause-toggle").addClass("on"),cad.pause=!0,SharkGame.persistentFlags.pause=!0,res.minuteHand.active&&res.minuteHand.toggleMinuteHand())},showTooltip(){cad.pause?$("#tooltipbox").html("Click to <strong>unpause</strong>."):$("#tooltipbox").html("Click to <strong>pause</strong>, stopping most timers and all resources.")}},dial:{init(){SharkGame.persistentFlags.dialSetting=1}},reconstructResourcesTable(){res.resetResourceTableMinWidth();let e=$("#resourceTable");const a=$("#status");if(SharkGame.Settings.current.smallTable?e.addClass("littleGeneralText"):e.removeClass("littleGeneralText"),e.length<=0){a.prepend($("<div>").attr("id","token-div")),a.prepend($("<div>").attr("id","token-description")),a.prepend($("<div>").attr("id","fake-minute-hand-div")),a.prepend($("<div>").attr("id","minute-hand-div")),a.prepend("<h3>Stuff</h3>");const r=$("<div>").attr("id","resourceTableContainer");e=$("<table>").attr("id","resourceTable"),r.append(e),a.append(r)}e.empty();let r=!1;SharkGame.Settings.current.groupResources?$.each(SharkGame.ResourceCategories,((a,t)=>{if(res.isCategoryVisible(t)){const s=res.collapsedRows.has(a)?"⯈":"⯆",o=$("<tr>").append($("<td>").attr("colSpan",3).append($("<h3>").html(`<span class="collapser">${s}</span><span>${a}</span>`).css("text-align","left"))).on("click",(()=>SharkGame.Resources.collapseResourceTableRow(a)));e.append(o),_.each(t.resources,(t=>{if(res.getTotalResource(t)>0||SharkGame.PlayerResources.get(t).discovered&&world.doesResourceExist(t)){if(!res.collapsedRows.has(a)){const a=res.constructResourceTableRow(t);e.append(a)}r=!0}}))}})):SharkGame.ResourceMap.forEach(((a,t)=>{if((res.getTotalResource(t)>0||SharkGame.PlayerResources.get(t).discovered)&&world.doesResourceExist(t)&&res.isCategoryVisible(SharkGame.ResourceCategories[res.getCategoryOfResource(t)])){const a=res.constructResourceTableRow(t);e.append(a),r=!0}})),r?(a.show(),_.each(res.tokens.list,(e=>{SharkGame.flags.tokens&&"NA"!==SharkGame.flags.tokens[e.attr("id")]&&res.tokens.reapplyToken(e)}))):a.hide(),res.setResourceTableMinWidth(),res.rebuildTable=!1},setResourceTableMinWidth(){$("#resourceTable").css("min-width",$("#resourceTable").outerWidth()+"px")},resetResourceTableMinWidth(){$("#resourceTable").css("min-width","0px")},collapseResourceTableRow(e){this.collapsedRows.has(e)?this.collapsedRows.delete(e):this.collapsedRows.add(e),this.reconstructResourcesTable()},constructResourceTableRow(e){const a=SharkGame.PlayerResources.get(e),r=res.getIncome(e),t=$("<tr>").attr("id",e).on("mouseenter",res.tableTextEnter).on("mouseleave",res.tableTextLeave);if(a.totalAmount>0||SharkGame.PlayerResources.get(e).discovered){t.append($("<td>").attr("id","resource-"+e).html(sharktext.getResourceName(e,void 0,void 0,sharkcolor.getVariableColor("--color-darker"))).on("dragstart",res.tokens.handleResourceDragStart).on("dragover",(a=>{res.tokens.canBePlacedOn("resource-"+e)&&res.tokens.chromeForcesWorkarounds&&(SharkGame.Settings.current.showTooltips&&$("#tooltipbox").html(sharktext.getResourceName(e,!1,69,sharkcolor.getElementColor("tooltipbox","background-color"))+" efficiency x"+(SharkGame.Aspects.coordinatedCooperation.level+2)*(SharkGame.Aspects.collectiveCooperation.level+1)),a.originalEvent.preventDefault())})).on("dragend",res.tokens.handleDragEnd).on("drop",res.tokens.dropToken).on("click",res.tokens.tryClickToPlace)),t.append($("<td>").attr("id","amount-"+e).html("⠀"+sharktext.beautify(a.amount)));const s=$("<td>").attr("id","income-"+e).on("dragstart",res.tokens.handleResourceDragStart).on("dragover",(a=>{res.tokens.canBePlacedOn("income-"+e)&&res.tokens.chromeForcesWorkarounds&&(SharkGame.Settings.current.showTooltips&&$("#tooltipbox").html("all "+sharktext.getResourceName(e,!1,69,sharkcolor.getElementColor("tooltipbox","background-color"))+" gains x"+(SharkGame.Aspects.coordinatedCooperation.level+2)*(SharkGame.Aspects.collectiveCooperation.level+1)),a.originalEvent.preventDefault())})).on("dragend",res.tokens.handleDragEnd).on("drop",res.tokens.dropToken).on("click",res.tokens.tryClickToPlace);if(t.append(s),Math.abs(r)>SharkGame.EPSILON){const e=r>0?"+":"";s.html("⠀<span class='click-passthrough' style='color:"+res.INCOME_COLOR+"'>"+e+sharktext.beautifyIncome(r)+"</span>")}}return t},tableTextEnter(e,a){if(!SharkGame.Settings.current.showTooltips)return;if(!a&&!(a=$(this).attr("id")))return;const r=SharkGame.FlippedBreakdownIncomeTable.get(a);let t="",s="";$.each(SharkGame.BreakdownIncomeTable.get(a),((e,a)=>{if(!world.doesResourceExist(e))return!0;a>0?t+=`<br>\n                ${sharktext.beautifyIncome(a," "+sharktext.getResourceName(e,!1,!1,sharkcolor.getElementColor("tooltipbox","background-color"))).bold()}`:a<0&&(s+=`<br>\n                ${sharktext.beautifyIncome(-a," "+sharktext.getResourceName(e,!1,!1,sharkcolor.getElementColor("tooltipbox","background-color"))).bold()}`)}));let o="",n="";$.each(r,((e,a)=>{Math.abs(a)>SharkGame.EPSILON&&(a>0?(o+="<br>",o+=(sharktext.shouldHideNumberOfThis(e)?"":"<strong>"+sharktext.beautify(res.getResource(e))+"</strong> ")+sharktext.getResourceName(e,!1,!1,sharkcolor.getElementColor("tooltipbox","background-color"))+"  <span class='littleTooltipText'>at</span>  "+sharktext.beautifyIncome(a).bold()):a<0&&(n+="<br>",n+=(sharktext.shouldHideNumberOfThis(e)?"":"<strong>"+sharktext.beautify(res.getResource(e))+"</strong> ")+sharktext.getResourceName(e,!1,!1,sharkcolor.getElementColor("tooltipbox","background-color"))+"  <span class='littleTooltipText'>at</span>  "+sharktext.beautifyIncome(-a).bold()))}));const i={};i[a]=res.getResource(a);const l=res.condenseNode(i),c={generators:{increase:{},decrease:{}},resources:{increase:{},decrease:{}}};$.each(l.genAffect,((e,a)=>{switch(e){case"increase":$.each(a,((e,a)=>{c.generators.increase[e]=a}));break;case"decrease":$.each(a,((e,a)=>{c.generators.decrease[e]=-a}));break;case"multincrease":$.each(a,((e,a)=>{"number"!=typeof c.generators.increase[e]?c.generators.increase[e]=a:(c.generators.increase[e]+=1,c.generators.increase[e]*=1+a,c.generators.increase[e]-=1)}));break;case"multdecrease":$.each(a,((e,a)=>{"number"!=typeof c.generators.decrease[e]?c.generators.decrease[e]=-a:(c.generators.decrease[e]+=1,c.generators.decrease[e]*=1-a,c.generators.decrease[e]-=1)}))}})),$.each(l.resAffect,((e,a)=>{switch(e){case"increase":$.each(a,((e,a)=>{c.resources.increase[e]=a}));break;case"decrease":$.each(a,((e,a)=>{c.resources.decrease[e]=-a}));break;case"multincrease":$.each(a,((e,a)=>{"number"!=typeof c.resources.increase[e]?c.resources.increase[e]=a:(c.resources.increase[e]+=1,c.resources.increase[e]*=1+a,c.resources.increase[e]-=1)}));break;case"multdecrease":$.each(a,((e,a)=>{"number"!=typeof c.resources.decrease[e]?c.resources.decrease[e]=-a:(c.resources.decrease[e]+=1,c.resources.decrease[e]*=1-a,c.resources.decrease[e]-=1)}))}}));let m="";$.each(c.generators.increase,((e,a)=>{world.doesResourceExist(e)&&res.getResource(e)>SharkGame.EPSILON&&(m+="<br>",m+=sharktext.getResourceName(e,!1,1,sharkcolor.getElementColor("tooltipbox","background-color"))+" speed by "+sharktext.boldString(`${sharktext.beautify(Math.floor(100*a))}%`))})),$.each(c.resources.increase,((e,a)=>{world.doesResourceExist(e)&&res.getResource(e)>SharkGame.EPSILON&&(m+="<br>",m+=sharktext.getResourceName(e,!1,1,sharkcolor.getElementColor("tooltipbox","background-color"))+" gains by "+sharktext.boldString(`${sharktext.beautify(Math.floor(100*a))}%`))}));let u="";$.each(c.generators.decrease,((e,a)=>{a<0&&(a=1+a),world.doesResourceExist(e)&&res.getResource(e)>SharkGame.EPSILON&&(u+="<br>",u+=sharktext.getResourceName(e,!1,1,sharkcolor.getElementColor("tooltipbox","background-color"))+" speed by "+sharktext.boldString(`${sharktext.beautify(Math.floor(100*a))}%`))})),$.each(c.resources.decrease,((e,a)=>{a<0&&(a=1+a),world.doesResourceExist(e)&&res.getResource(e)>SharkGame.EPSILON&&(u+="<br>",u+=sharktext.getResourceName(e,!1,1,sharkcolor.getElementColor("tooltipbox","background-color"))+" gains by "+sharktext.boldString(`${sharktext.beautify(Math.floor(100*a))}%`))}));let d=sharktext.getResourceName(a,!1,2,sharkcolor.getElementColor("tooltipbox","background-color"));""!==t&&(d+="<br><span class='littleTooltipText'>"+sharktext.getIsOrAre(a,2).toUpperCase()+" PRODUCING</span>"+t),""!==s&&(d+="<br><span class='littleTooltipText'>"+sharktext.getIsOrAre(a,2).toUpperCase()+" CONSUMING</span>"+s),(t||s)&&(o||n)&&(d+="<br><span class='littleTooltipText'>and</span>"),""!==o&&(d+="<br><span class='littleTooltipText'>"+sharktext.getIsOrAre(a,2).toUpperCase()+" PRODUCED BY</span>"+o),""!==n&&(d+="<br><span class='littleTooltipText'>"+sharktext.getIsOrAre(a,2).toUpperCase()+" CONSUMED BY</span>"+n),(m||u)&&(o||n||t||s)&&(d+="<br><span class='littleTooltipText'>and</span>"),""!==m&&(d+="<br><span class='littleTooltipText'>"+sharktext.getIsOrAre(a,2).toUpperCase()+" INCREASING</span>"+m),""!==u&&(d+="<br><span class='littleTooltipText'>"+sharktext.getIsOrAre(a,2).toUpperCase()+" DECREASING</span>"+u),SharkGame.ResourceMap.get(a).desc&&(d+="<hr class='hrForTooltipSeparation'><span class='medDesc'>"+SharkGame.ResourceMap.get(a).desc+"</span>"),document.getElementById("tooltipbox").innerHTML!==d.replace(/'/g,'"')&&(document.getElementById("tooltipbox").innerHTML=d),$("#tooltipbox").removeClass("forHomeButtonOrGrotto").removeClass("gives-consumer").attr("current",""),$(".tooltip").addClass("forIncomeTable").attr("current",a)},tableTextLeave(){document.getElementById("tooltipbox").innerHTML="",$(".tooltip").removeClass("forIncomeTable").attr("current","")},buildIncomeNetwork(){const e=SharkGame.GeneratorIncomeAffectors,a=SharkGame.GeneratorIncomeAffected,r=SharkGame.ResourceCategories;$.each(e,(t=>{$.each(e[t],(s=>{$.each(e[t][s],((e,o)=>{const n=res.isCategory(e)?r[e].resources:[e];$.each(n,((e,r)=>{world.doesResourceExist(r)&&world.doesResourceExist(t)&&res.addNetworkNode(a,r,s,t,o)}))}))}))}));const t=SharkGame.ResourceIncomeAffectors,s=SharkGame.ResourceIncomeAffected;$.each(t,(e=>{$.each(t[e],(a=>{$.each(t[e][a],((t,o)=>{const n=res.isCategory(t)?r[t].resources:[t];$.each(n,((r,t)=>{world.doesResourceExist(t)&&world.doesResourceExist(e)&&res.addNetworkNode(s,t,a,e,o)}))}))}))}))},clearNetworks(){SharkGame.GeneratorIncomeAffected={},SharkGame.ResourceIncomeAffected={}},addNetworkNode(e,a,r,t,s){e[a]||(e[a]={}),e[a][r]||(e[a][r]={}),e[a][r][t]=s},applyModifier(e,a,r){res.isCategory(a)?a=res.getResourcesInCategory(a):"object"!=typeof a&&(a=[a]),_.each(a,(a=>{const t=SharkGame.ModifierReference.get(e),s=t.type,o=t.category;SharkGame.ModifierMap.get(a)[o][s][e]=t.apply(SharkGame.ModifierMap.get(a)[o][s][e],r,a)}))},reapplyModifiers(e,a){let r=SharkGame.ResourceMap.get(e).baseIncome[a];SharkGame.ModifierReference.forEach(((t,s)=>{const o=SharkGame.ModifierMap.get(e)[t.category][t.type][s],n=SharkGame.ModifierMap.get(a)[t.category][t.type][s];r=t.applyToInput(r,o,n,e,a)})),SharkGame.ResourceMap.get(e).income[a]=r},getMultiplierProduct(e,a,r){let t=1;return $.each(SharkGame.ModifierTypes[e].multiplier,((e,s)=>{const o=SharkGame.ModifierMap.get(a)[s.category][s.type][e],n=SharkGame.ModifierMap.get(r)[s.category][s.type][e];t*=s.getEffect(o,n,a,r)})),t},testGracePeriod(){let e=!0;return SharkGame.PlayerIncomeTable.forEach(((a,r)=>{res.isInCategory(r,"harmful")||0===a||(e=!1)})),e},condenseNode(e,a){function r(e,a){switch(e){case"multiply":return a>0?"increase":"decrease";case"exponentiate":return a>1?"multincrease":"multdecrease"}}const t={genAffect:{increase:{},decrease:{},multincrease:{},multdecrease:{}},resAffect:{increase:{},decrease:{},multincrease:{},multdecrease:{}}};return $.each(e,((e,s)=>{let o,n;o=a?SharkGame.GeneratorIncomeAffected[e]:SharkGame.GeneratorIncomeAffectors[e],o&&$.each(o,((e,a)=>{$.each(a,((a,o)=>{if(t.genAffect[r(e,o)][a])switch(e){case"multiply":t.genAffect[r(e,o)][a]+=s*o;break;case"exponentiate":t.genAffect[r(e,o)][a]*=o**s}else switch(e){case"multiply":t.genAffect[r(e,o)][a]=s*o;break;case"exponentiate":t.genAffect[r(e,o)][a]=o**s}}))})),n=a?SharkGame.ResourceIncomeAffected[e]:SharkGame.ResourceIncomeAffectors[e],n&&$.each(n,((e,a)=>{$.each(a,((a,o)=>{if(t.resAffect[r(e,o)][a])switch(e){case"multiply":t.resAffect[r(e,o)][a]+=s*o;break;case"exponentiate":t.resAffect[r(e,o)][a]*=o**s}else switch(e){case"multiply":t.resAffect[r(e,o)][a]=s*o;break;case"exponentiate":t.resAffect[r(e,o)][a]=o**s}}))}))})),t}};
"use strict";SharkGame.Log={initialised:!1,messages:[],totalCount:0,init(){this.moveLog(),log.initialised=!0,$(window).on("resize",_.debounce(this.changeHeight,300)),this.changeHeight()},moveLog(){$("#log").remove();const e=$("<div id='log'></div>");switch(SharkGame.Settings.current.logLocation){case"left":$("#sidebar").append(e.append("<h3>Log<h3/>").append($("<ul id='messageList'></ul>").addClass("forLeftSide"))),$("#wrapper").removeClass("topLogActive"),$("#titlebackground").removeClass("topLogActive"),$("#tabList").css("margin-right",0);break;case"top":$("#titlebar").append(e),e.append($("<button id='extendLog' class='min close-button'>⯆</button>").on("click",log.toggleExtendedLog)).append("<ul id='messageList'></ul>"),$("#wrapper").addClass("topLogActive"),$("#titlebackground").addClass("topLogActive"),$("#tabList").css("margin-right",0);break;default:$("#rightLogContainer").append(e.append("<h3>Log<h3/>").append($("<ul id='messageList'></ul>").addClass("forRightSide"))),$("#wrapper").removeClass("topLogActive"),$("#titlebackground").removeClass("topLogActive"),$("#rightLogContainer").css("position","static").css("top",$("#rightLogContainer").offset().top).css("position","sticky"),SharkGame.TabHandler.validateTabWidth(),this.changeHeight()}const s=_.cloneDeep(log.messages);log.messages=[],_.each(s,(e=>{e.hasClass("discovery")?log.addDiscovery(e.html()):e.hasClass("error")?log.addError(e.html()):log.addMessage(e.html())}))},changeHeight(){if("left"!==SharkGame.Settings.current.logLocation&&"top"!==SharkGame.Settings.current.logLocation){const e=$(window).outerHeight(!0)-document.getElementById("messageList").getBoundingClientRect().top-$("#copyright").height()-10;$("#messageList").css("max-height",e+"px")}},isNextMessageEven(){return this.totalCount%2==1},addMessage(e){const s=SharkGame.Settings.current.showAnimations;log.initialised||log.init();const t=$("<li>").html(e);function o(e,s){return e.getBoundingClientRect().top+("bottom"===s?e.getBoundingClientRect().y:0)-a.getBoundingClientRect().top}log.isNextMessageEven()&&t.addClass("evenMessage");const a=document.querySelector("#messageList");if(log.messages.push(t),0!==a.scrollTop){t.prependTo("#messageList");let e=null;for(let s=log.messages.length-1;s>0;s--)if(o(log.messages[s][0],"bottom")>0){e=s;break}const s=log.messages[_.clamp(e+1,log.messages.length-1)][0],g=a.scrollTop+o(s,"top");$(a).animate({scrollTop:g+"px"},50,"linear")}else s?t.hide().css("opacity",0).prependTo("#messageList").slideDown(50).animate({opacity:1},100):t.prependTo("#messageList");return log.correctLogLength(),this.totalCount+=1,t},addError(e){e instanceof Error&&(console.error(e),e=e.message);const s=log.addMessage("Error: "+e);return s.addClass("error"),s},addDiscovery(e){const s=log.addMessage(e);return s.addClass("discovery"),s},correctLogLength(){const e=SharkGame.Settings.current.showAnimations,s=SharkGame.Settings.current.logMessageMax;if(log.messages.length>=s)for(;log.messages.length>s;){const s=log.messages[0];e?log.messages[0].animate({opacity:0},100,"swing",(()=>{$(s).remove()})):s.remove(),log.messages.shift()}},clearMessages(e=!0){_.each(log.messages,(e=>{e.remove()})),log.messages=[],e&&log.addMessage("Log cleared.")},toggleExtendedLog(){const e=$("#title"),s=$("#messageList");s.hasClass("scrollable")?(e.removeClass("biggerTitleDiv"),s.removeClass("scrollable"),$("#extendLog").html("⯆")):(e.addClass("biggerTitleDiv"),s.addClass("scrollable"),$("#extendLog").html("⯅"))},haveAnyMessages:()=>log.messages.length>0};
SharkGame.Keybinds={defaultBinds:{Period:"bind home ocean button",P:"pause",A:"press all buying buttons",L:"buy topmost upgrade",R:"return all tokens","Shift + 1":"switch to home tab","Shift + 2":"switch to lab tab","Shift + 3":"switch to grotto tab","Shift + 4":"switch to recycler tab","Shift + 5":"switch to gate tab","Shift + 6":"switch to reflection tab","Shift + Z":"switch to buy 1","Shift + X":"switch to buy 10","Shift + C":"switch to buy 100","Shift + V":"switch to buy 1/3 max","Shift + B":"switch to buy 1/2 max","Shift + N":"switch to buy max","Shift + M":"switch to buy custom","Control + O":"open options","Control + S":"save"},keybinds:{},actions:["nothing","bind home ocean button","press all buying buttons","buy topmost upgrade","return all tokens","toggle idle time use","pause","save","skip world","enter gate","open options","switch to home tab","switch to lab tab","switch to grotto tab","switch to recycler tab","switch to gate tab","switch to reflection tab","switch home button tab left","switch home button tab right","switch to buy 1","switch to buy 10","switch to buy 100","switch to buy 1/3 max","switch to buy 1/2 max","switch to buy max","switch to buy custom"],modifierKeys:{ShiftLeft:0,ShiftRight:0,AltLeft:0,AltRight:0,ControlLeft:0,ControlRight:0},init(){$.isEmptyObject(this.keybinds)&&this.resetKeybindsToDefault(),this.bindMode=!1,this.bindModeLock=!1,this.waitForKey=!1,this.settingAction=void 0,this.settingKey=void 0},setup(){},resetKeybindsToDefault(){this.keybinds=_.cloneDeep(this.defaultBinds)},compressKeyID:e=>e=e.replace(/ /gi,"").replace("+","-"),cleanActionID(e){return this.actions.includes(e)||(SharkGame.HomeActions.getActionTable()[e]?e=SharkGame.HomeActions.getActionData(SharkGame.HomeActions.getActionTable(),e).name:_.each(SharkGame.HomeActions,(t=>{if("object"==typeof t&&t[e])return e=t[e].name,!1}))),e},cleanID:e=>(e=e.replace("Digit","").replace("Key","").replace("CapsLock","Caps Lock").replace("NumLock","Num Lock").replace("ScrollLock","Scroll Lock").replace("ContextMenu","Context Menu"),_.each(["Left","Right","Up","Down","Numpad"],(t=>{e.includes(t)&&(e=`${t} `+e.replace(t,""))})),e=e.replace("Up Page","Page Up").replace("Down Page","Page Down")),composeKeys(e){return _.each(["Shift","Alt","Control"],(t=>{e.includes(t)||(this.modifierKeys[t+"Left"]||this.modifierKeys[t+"Right"])&&(e=t+" + "+e)})),e},handleKeyUp(e){const t=this.modifierKeys[e];_.isUndefined(t)||(this.modifierKeys[e]=0),e=this.cleanID(e),e=this.composeKeys(e);const a=this.keybinds[e];if(this.bindMode&&"bind home ocean button"!==a)_.isUndefined(t)&&(this.settingKey=e,this.updateBindModeState());else if(a)return this.handleUpBind(a)},handleKeyDown(e){const t=this.modifierKeys[e],a=!_.isUndefined(t);a&&(this.modifierKeys[e]=1),e=this.cleanID(e),e=this.composeKeys(e);const s=this.keybinds[e];if(this.bindMode&&"bind home ocean button"!==s)a||(this.settingKey=e,this.updateBindModeState());else{if(this.waitForKey&&!s&&!$.isEmptyObject($("#new-bind-button"))&&!a)return this.bindMenuNewBind(e),!0;if(s)return this.handleDownBind(s)}},handleUpBind(e){if(!this.tempDisableBind)return!(!SharkGame.HomeActions.getActionData(SharkGame.HomeActions.getActionTable(),e)||!$(`#${e}`).hasClass("keep-button-pressed"))&&($(`#${e}`).removeClass("keep-button-pressed"),home.onHomeButton(null,e),!0)},handleDownBind(e){if(!this.tempDisableBind&&e){switch(e){case"test":case"open bind menu":break;case"bind home ocean button":this.bindModeLock||this.toggleBindMode(!0);break;case"pause":SharkGame.Aspects.meditation.level&&!SharkGame.gameOver&&res.pause.togglePause();break;case"switch to home tab":SharkGame.TabHandler.keybindSwitchTab("home");break;case"switch to lab tab":SharkGame.TabHandler.keybindSwitchTab("lab");break;case"switch to grotto tab":SharkGame.TabHandler.keybindSwitchTab("stats");break;case"switch to recycler tab":SharkGame.TabHandler.keybindSwitchTab("recycler");break;case"switch to gate tab":SharkGame.TabHandler.keybindSwitchTab("gate");break;case"switch to reflection tab":SharkGame.TabHandler.keybindSwitchTab("reflection");break;case"switch home button tab left":"home"===SharkGame.Tabs.current&&home.changeButtonTab(home.getPreviousButtonTab());break;case"switch home button tab right":"home"===SharkGame.Tabs.current&&home.changeButtonTab(home.getNextButtonTab());break;case"switch to buy 1":$("#buy-1").hasClass("disabled")||(SharkGame.Settings.current.buyAmount=1,$("#custom-input").attr("disabled",!0),$("button[id^='buy-']").removeClass("disabled"),$("#buy-1").addClass("disabled"));break;case"switch to buy 10":$("#buy-10").hasClass("disabled")||(SharkGame.Settings.current.buyAmount=10,$("#custom-input").attr("disabled",!0),$("button[id^='buy-']").removeClass("disabled"),$("#buy-10").addClass("disabled"));break;case"switch to buy 100":$("#buy-100").hasClass("disabled")||(SharkGame.Settings.current.buyAmount=100,$("#custom-input").attr("disabled",!0),$("button[id^='buy-']").removeClass("disabled"),$("#buy-100").addClass("disabled"));break;case"switch to buy 1/3 max":$("#buy--3").hasClass("disabled")||(SharkGame.Settings.current.buyAmount=-3,$("#custom-input").attr("disabled",!0),$("button[id^='buy-']").removeClass("disabled"),$("#buy--3").addClass("disabled"));break;case"switch to buy 1/2 max":$("#buy--2").hasClass("disabled")||(SharkGame.Settings.current.buyAmount=-2,$("#custom-input").attr("disabled",!0),$("button[id^='buy-']").removeClass("disabled"),$("#buy--2").addClass("disabled"));break;case"switch to buy max":$("#buy--1").hasClass("disabled")||(SharkGame.Settings.current.buyAmount=-1,$("#custom-input").attr("disabled",!0),$("button[id^='buy-']").removeClass("disabled"),$("#buy--1").addClass("disabled"));break;case"switch to buy custom":$("#buy-custom").hasClass("disabled")||(SharkGame.Settings.current.buyAmount="custom",$("#custom-input").attr("disabled",!1),$("button[id^='buy-']").removeClass("disabled"),$("#buy-custom").addClass("disabled"));break;case"open options":SharkGame.PaneHandler.isPaneAlreadyUp("Options")||SharkGame.PaneHandler.showOptions();break;case"save":SharkGame.Save.saveGame(),SharkGame.Log.addMessage("Saved game.");break;case"skip world":SharkGame.gameOver||SharkGame.TitleBar.skipLink.onClick();break;case"toggle idle time use":SharkGame.persistentFlags.everIdled&&!SharkGame.gameOver&&res.minuteHand.toggleMinuteHand();break;case"return all tokens":_.each(res.tokens.list,(e=>{res.tokens.tryReturnToken(null,!1,e)}));break;case"buy topmost upgrade":cad.pause||cad.stop||SharkGame.Lab.onLabButton(SharkGame.Lab.findAllAffordableUpgrades()[0]);break;case"press all buying buttons":SharkGame.flags.pressedAllButtonsThisTick||(_.each(home.buttonNamesList,((e,t)=>{t=SharkGame.HomeActions.getActionData(SharkGame.HomeActions.getActionTable(),e),home.doesButtonGiveNegativeThing(t)||!home.shouldHomeButtonBeUsable(t)||t.isRemoved||home.onHomeButton(null,e)})),SharkGame.flags.pressedAllButtonsThisTick=!0);break;case"enter gate":SharkGame.Gate.shouldBeOpen()&&SharkGame.Gate.enterGate();break;default:if(!SharkGame.HomeActions.getActionData(SharkGame.HomeActions.getActionTable(),e))return!1;$(`#${e}`).addClass("keep-button-pressed")}return!0}return!1},addKeybind(e,t){this.keybinds[e]=t},bindMenuNewBind(e){this.waitForKey=!1,this.addKeybind(e,"nothing"),SharkGame.PaneHandler.nextPaneInStack(),SharkGame.PaneHandler.showKeybinds()},updateBindModeOverlay(e){if(this.bindMode){SharkGame.OverlayHandler.isOverlayShown()||SharkGame.OverlayHandler.revealOverlay(250,.8),$("#buttonList").children().addClass("front");const e=$("<div>").attr("id","keybind-overlay-container");e.css("width",SharkGame.Settings.current.sidebarWidth),$("#overlay").empty(),e.append($("<h1>").html("ACTION BIND MODE")),_.isUndefined(this.settingAction)&&_.isUndefined(this.settingKey)?e.append($("<p>").html("<strong>Click the button you want to bind, then press a key to bind it to.</strong>")):!_.isUndefined(this.settingAction)&&_.isUndefined(this.settingKey)?e.append($("<p>").html(`<strong>Press a key to bind to ${this.cleanActionID(this.settingAction)}.</strong>`)):_.isUndefined(this.settingAction)&&!_.isUndefined(this.settingKey)?e.append($("<p>").html(`<strong>Click a button to bind to ${this.settingKey}.</strong>`)):e.append($("<p>").html(`<strong>Bound ${this.settingKey} to ${this.cleanActionID(this.settingAction)}.</strong>`)),$("#overlay").append(e),$("#overlay").on("click",(()=>{this.toggleBindMode(!0)})).css("cursor","pointer")}else $("#overlay").css("cursor",""),this.bindModeLock=!0,e?SharkGame.OverlayHandler.hideOverlay(250,(()=>{$("#buttonList").children().removeClass("front"),$("#overlay").empty(),$("#overlay").off("click"),this.bindModeLock=!1})):setTimeout((()=>{SharkGame.OverlayHandler.hideOverlay(250,(()=>{$("#buttonList").children().removeClass("front"),$("#overlay").empty(),$("#overlay").off("click"),this.bindModeLock=!1}))}),1e3)},updateBindModeState(e){this.updateBindModeOverlay(e),this.checkForBindModeCombo()&&(this.addKeybind(this.composeKeys(this.settingKey),this.settingAction),this.toggleBindMode())},checkForBindModeCombo(){return this.settingAction&&this.settingKey},toggleBindMode(e){this.settingKey=void 0,this.settingAction=void 0,SharkGame.PaneHandler.isStackClosable()&&"home"===SharkGame.Tabs.current&&(this.bindMode?this.bindMode=!1:(this.bindMode=!0,SharkGame.PaneHandler.tryWipeStack()),this.updateBindModeState(e))}};